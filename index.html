<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ | è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­ä»˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f1f5f9;
            color: #334155;
        }
        .text-custom-green { color: #15803d; }
        .bg-custom-green { background-color: #15803d; }
        .border-custom-green { border-color: #15803d; }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            margin: 8px 0;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #10b981;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: -8px;
            transition: transform 0.1s;
        }
        .dual-range::-webkit-slider-thumb { border: 2px solid #15803d; }
        input[type=range]::-webkit-slider-thumb:active { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
        .input-group:focus-within {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .input-group-dual:focus-within {
            border-color: #15803d;
            box-shadow: 0 0 0 3px rgba(21, 128, 61, 0.1);
        }
        .bg-required { background-color: #fef9c3; border-color: #fde047; }
        .bg-cleared { background-color: #ffffff; border-color: #e2e8f0; }

        .tab-btn {
            color: #64748b;
            border-bottom: 3px solid transparent;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .tab-btn.active {
            color: #15803d;
            border-bottom: 3px solid #15803d;
        }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ç”¨ã®è£…é£¾ */
        .pyramid-label { font-size: 10px; font-weight: bold; }
        .tier-active { filter: drop-shadow(0 0 8px rgba(255,255,255,0.8)); stroke: #fff; stroke-width: 2px; }
        .marker-pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { r: 4; opacity: 1; }
            50% { r: 7; opacity: 0.5; }
            100% { r: 4; opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 md:px-8 pt-4 pb-0">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800 flex items-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-custom-green mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
            </h1>
            
            <div class="flex space-x-4 md:space-x-8 overflow-x-auto">
                <button onclick="switchTab('single')" id="tab-btn-single" class="tab-btn active pb-3 px-1 whitespace-nowrap transition-colors">1éŠ˜æŸ„ã§è¨ˆç®—</button>
                <button onclick="switchTab('dual')" id="tab-btn-dual" class="tab-btn pb-3 px-1 whitespace-nowrap transition-colors">2éŠ˜æŸ„ã§è¨ˆç®—</button>
                <button onclick="switchTab('hierarchy')" id="tab-btn-hierarchy" class="tab-btn pb-3 px-1 whitespace-nowrap transition-colors">
                    <span class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                        è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­
                    </span>
                </button>
                <button onclick="switchTab('guide')" id="tab-btn-guide" class="tab-btn pb-3 px-1 whitespace-nowrap transition-colors">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>
            </div>
        </div>
    </div>

    <div class="flex-grow p-4 md:p-8 max-w-6xl mx-auto w-full">

        <div id="tab-content-single" class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-start fade-in">
            <div class="lg:col-span-5 space-y-4">
                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100">
                    <h2 class="text-lg font-bold text-slate-700 mb-3">1. é‹ç”¨å•†å“ã‚’é¸ã¶</h2>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button onclick="selectProductSingle('sp500')" id="btn-single-sp500" class="p-3 rounded-xl border transition-all duration-200 text-center relative font-bold">S&P500 (ç±³å›½æ ª)</button>
                        <button onclick="selectProductSingle('all')" id="btn-single-all" class="p-3 rounded-xl border transition-all duration-200 text-center relative font-bold">å…¨ä¸–ç•Œæ ªå¼</button>
                    </div>
                    <div class="bg-slate-50 rounded-xl p-3 border border-slate-200">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-slate-500">éå»11å¹´ã®å¹³å‡åˆ©å›ã‚Š</span>
                            <a href="#" id="single-source-link" target="_blank" class="text-xs text-emerald-500 hover:underline flex items-center">ãƒ‡ãƒ¼ã‚¿å‚ç…§å…ƒ<svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg></a>
                        </div>
                        <div class="flex items-end text-emerald-600">
                            <span class="text-2xl font-bold" id="single-display-rate">--.--</span><span class="text-base font-bold mb-0.5 ml-0.5">%</span>
                        </div>
                        <input type="hidden" id="single-annualRate" value="13.25">
                    </div>
                </section>

                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 space-y-5">
                    <h2 class="text-lg font-bold text-slate-700">2. é‡‘é¡ã‚’å…¥ã‚Œã‚‹</h2>
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-sm font-bold text-slate-600">æƒ³å®šåˆ©å›ã‚Š (å¹´ç‡)</label>
                            <button onclick="resetSingleRate()" class="text-xs text-emerald-500 font-bold hover:text-emerald-600 transition">å¹³å‡å€¤ã«æˆ»ã™</button>
                        </div>
                        <div class="input-group flex items-center bg-white border-2 border-slate-200 rounded-xl px-3 py-2 transition-colors">
                            <input type="number" id="single-input-rate" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="13.25" step="0.01" oninput="calculateSingle()" onfocus="this.select()">
                            <span class="text-slate-400 font-bold ml-2">%</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 block">åˆæœŸæŠ•è³‡é¡ (å…ƒæ‰‹)</label>
                        <div id="single-initialGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 transition-colors bg-required">
                            <input type="number" id="single-initial" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right placeholder-slate-400" placeholder="0" oninput="checkInput('single-initial', 'single-initialGroup'); calculateSingle();" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">ä¸‡å††</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between">
                            <span>æ¯æœˆã®ç©ç«‹é¡</span>
                            <span class="text-emerald-500" id="single-monthlyLabel">ãªã—</span>
                        </label>
                        <input type="range" id="single-monthlySlider" min="0" max="30" value="3" step="1" oninput="syncInputs('single-monthlySlider', 'single-monthly', 'single-monthlyLabel', 'ä¸‡', true)">
                        <div id="single-monthlyGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 mt-1 transition-colors bg-required">
                            <input type="number" id="single-monthly" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right placeholder-slate-400" placeholder="ä¾‹: 3" value="3" oninput="checkInput('single-monthly', 'single-monthlyGroup'); syncInputs('single-monthly', 'single-monthlySlider', 'single-monthlyLabel', 'ä¸‡', true);" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">ä¸‡å††</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1">é‹ç”¨æœŸé–“</label>
                        <input type="range" id="single-yearsSlider" min="1" max="50" value="20" oninput="syncInputs('single-yearsSlider', 'single-years', null, null, true)">
                        <div id="single-yearsGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 mt-1 transition-colors bg-required">
                            <input type="number" id="single-years" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right placeholder-slate-400" value="20" oninput="checkInput('single-years', 'single-yearsGroup'); syncInputs('single-years', 'single-yearsSlider', null, null, true);" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">å¹´</span>
                        </div>
                    </div>
                </section>

                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100">
                    <h2 class="text-lg font-bold text-slate-700 mb-1">3. å–ã‚Šå´©ã—è¨­å®š <span class="text-xs font-normal text-slate-400 ml-2">(ä»»æ„)</span></h2>
                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between">
                            <span>æ¯å¹´1æœˆ1æ—¥ã®å–ã‚Šå´©ã—ç‡</span>
                            <span class="text-emerald-600 font-bold" id="single-withdrawalLabel">ãªã—</span>
                        </label>
                        <input type="range" id="single-withdrawalSlider" min="0" max="15" value="0" step="0.1" oninput="syncInputs('single-withdrawalSlider', 'single-withdrawal', 'single-withdrawalLabel', '%', true)">
                        <div class="flex items-center bg-white border-2 border-slate-200 rounded-xl px-3 py-2 mt-1 focus-within:border-emerald-500 transition-colors">
                            <input type="number" id="single-withdrawal" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="0" step="0.1" oninput="syncInputs('single-withdrawal', 'single-withdrawalSlider', 'single-withdrawalLabel', '%', true)" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">%</span>
                        </div>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-7 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl p-5 text-white shadow-md md:col-span-2">
                        <p class="text-emerald-50 text-sm font-bold mb-1">æœ€çµ‚è³‡ç”£æ®‹é«˜</p>
                        <div class="text-4xl md:text-5xl font-bold tracking-tight" id="single-displayFinalAsset">0å††</div>
                        <div class="mt-3 flex justify-between items-end border-t border-white/20 pt-3">
                            <div><p class="text-emerald-50 text-xs">é‹ç”¨åç›Š</p><p class="text-lg font-bold text-green-200" id="single-displayProfit">+0å††</p></div>
                            <div class="text-right"><p class="text-emerald-50 text-xs">ç´¯è¨ˆå—å–é¡</p><p class="text-lg font-bold text-orange-200" id="single-displayWithdrawn">0å††</p></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex flex-col justify-center">
                        <p class="text-slate-500 text-xs font-bold mb-1">ç´¯è¨ˆæŠ•è³‡é¡</p><p class="text-xl font-bold text-slate-700" id="single-displayInvestment">0å††</p>
                    </div>
                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex flex-col justify-center">
                        <p class="text-slate-500 text-xs font-bold mb-1">é©ç”¨ä¸­ã®å•†å“</p><p class="text-xl font-bold text-emerald-600" id="single-displayProduct">S&P500</p>
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                    <h3 class="text-lg font-bold text-slate-700 mb-3">è³‡ç”£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¨ç§»</h3>
                    <div class="relative h-72 w-full"><canvas id="single-chart"></canvas></div>
                </div>
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                     <button onclick="toggleTable('single-tableContent', 'single-tableArrow')" class="w-full p-4 flex justify-between items-center text-slate-700 font-bold hover:bg-slate-50 transition bg-white">
                        <span>å¹´æ¬¡è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹</span>
                        <svg id="single-tableArrow" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </button>
                    <div id="single-tableContent" class="hidden border-t border-slate-100 bg-slate-50 p-2">
                        <table class="w-full text-sm text-left whitespace-nowrap"><thead class="text-slate-500 bg-slate-100"><tr><th class="px-4 py-2 font-semibold">å¹´æ•°</th><th class="px-4 py-2 text-right font-semibold" id="single-col2Header">ç©ç«‹/å—å–</th><th class="px-4 py-2 text-right font-semibold">è³‡ç”£æ®‹é«˜</th></tr></thead><tbody id="single-tableBody" class="divide-y divide-slate-200 bg-white"></tbody></table>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-content-dual" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-start fade-in">
            <div class="lg:col-span-5 space-y-4">
                <h2 class="text-lg font-bold text-slate-700">1. éŠ˜æŸ„ã”ã¨ã®é‡‘é¡ã‚’æ±ºã‚ã‚‹</h2>
                <div class="bg-blue-50 rounded-2xl p-5 border border-blue-100 relative">
                    <div class="absolute top-4 right-4 text-blue-300"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg></div>
                    <h3 class="font-bold text-blue-800 mb-1 flex items-center">ğŸ‡ºğŸ‡¸ S&P500 (ç±³å›½æ ª)</h3>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-xs font-bold text-blue-600">æƒ³å®šåˆ©å›ã‚Š (å¹´ç‡)</label>
                            <button onclick="resetDualRate('sp500')" class="text-xs text-blue-500 hover:text-blue-700 font-bold cursor-pointer">å¹³å‡å€¤ã«æˆ»ã™</button>
                        </div>
                        <div class="input-group flex items-center bg-white border border-blue-200 rounded-xl px-2 py-1">
                            <input type="number" id="dual-sp500-rate" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right" value="13.25" step="0.01" oninput="calculateDual()" onfocus="this.select()">
                            <span class="text-slate-500 text-xs font-bold ml-1">%</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div><label class="text-xs font-bold text-blue-700 block mb-1">åˆæœŸæŠ•è³‡é¡</label><div class="input-group flex items-center bg-white border border-blue-200 rounded-xl px-3 py-2"><input type="number" id="dual-sp500-init" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right placeholder-slate-300" placeholder="0" oninput="calculateDual()" onfocus="this.select()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                        <div><label class="text-xs font-bold text-blue-700 block mb-1">æ¯æœˆã®ç©ç«‹é¡</label><div class="input-group flex items-center bg-white border border-blue-200 rounded-xl px-3 py-2"><input type="number" id="dual-sp500-month" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right placeholder-slate-300" placeholder="ä¾‹: 3" oninput="calculateDual()" onfocus="this.select()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                    </div>
                </div>
                <div class="bg-green-50 rounded-2xl p-5 border border-green-100 relative">
                    <div class="absolute top-4 right-4 text-green-300"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div>
                    <h3 class="font-bold text-green-800 mb-1 flex items-center">ğŸŒ å…¨ä¸–ç•Œæ ªå¼ (ã‚ªãƒ«ã‚«ãƒ³)</h3>
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-xs font-bold text-green-600">æƒ³å®šåˆ©å›ã‚Š (å¹´ç‡)</label>
                            <button onclick="resetDualRate('all')" class="text-xs text-green-500 hover:text-green-700 font-bold cursor-pointer">å¹³å‡å€¤ã«æˆ»ã™</button>
                        </div>
                        <div class="input-group flex items-center bg-white border border-green-200 rounded-xl px-2 py-1">
                            <input type="number" id="dual-all-rate" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right" value="9.99" step="0.01" oninput="calculateDual()" onfocus="this.select()">
                            <span class="text-slate-500 text-xs font-bold ml-1">%</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div><label class="text-xs font-bold text-green-700 block mb-1">åˆæœŸæŠ•è³‡é¡</label><div class="input-group flex items-center bg-white border border-green-200 rounded-xl px-3 py-2"><input type="number" id="dual-all-init" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right placeholder-slate-300" placeholder="0" oninput="calculateDual()" onfocus="this.select()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                        <div><label class="text-xs font-bold text-green-700 block mb-1">æ¯æœˆã®ç©ç«‹é¡</label><div class="input-group flex items-center bg-white border border-green-200 rounded-xl px-3 py-2"><input type="number" id="dual-all-month" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right placeholder-slate-300" placeholder="ä¾‹: 2" oninput="calculateDual()" onfocus="this.select()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                    </div>
                </div>
                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 space-y-5">
                    <h2 class="text-lg font-bold text-slate-700">2. æœŸé–“ã¨æ¡ä»¶ (å…±é€š)</h2>
                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1">é‹ç”¨æœŸé–“</label>
                        <input type="range" id="dual-yearsSlider" min="1" max="50" value="20" oninput="syncInputs('dual-yearsSlider', 'dual-years', null, null, false)" class="dual-range">
                        <div class="input-group-dual flex items-center border-2 rounded-xl px-3 py-2 mt-1 transition-colors bg-white border-slate-200">
                            <input type="number" id="dual-years" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="20" oninput="syncInputs('dual-years', 'dual-yearsSlider', null, null, false)" onfocus="this.select()"><span class="text-slate-500 font-bold ml-2">å¹´</span>
                        </div>
                    </div>
                </section>
            </div>
            <div class="lg:col-span-7 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="bg-gradient-to-br from-green-600 to-green-800 rounded-2xl p-5 text-white shadow-md md:col-span-2">
                        <p class="text-green-50 text-sm font-bold mb-1">æœ€çµ‚è³‡ç”£æ®‹é«˜ (åˆè¨ˆ)</p>
                        <div class="text-4xl md:text-5xl font-bold tracking-tight" id="dual-displayFinalAsset">0å††</div>
                        <div class="mt-3 flex justify-between items-end border-t border-white/20 pt-3">
                            <div><p class="text-green-100 text-xs">é‹ç”¨åç›Š</p><p class="text-lg font-bold text-green-200" id="dual-displayProfit">+0å††</p></div>
                            <div class="text-right"><p class="text-green-100 text-xs">ç´¯è¨ˆå—å–é¡</p><p class="text-lg font-bold text-orange-200" id="dual-displayWithdrawn">0å††</p></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex flex-col justify-center">
                        <p class="text-slate-500 text-xs font-bold mb-1">ç´¯è¨ˆæŠ•è³‡é¡ (åˆè¨ˆ)</p><p class="text-xl font-bold text-slate-700" id="dual-displayInvestment">0å††</p>
                    </div>
                    <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100 flex flex-col justify-center">
                        <p class="text-slate-500 text-xs font-bold mb-1">å†…è¨³ (æŠ•è³‡æ¯”ç‡)</p><p class="text-sm font-bold text-slate-700" id="dual-displayRatio">--</p>
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                    <h3 class="text-lg font-bold text-slate-700 mb-3">åˆè¨ˆè³‡ç”£ã®æ¨ç§»</h3>
                    <div class="relative h-72 w-full"><canvas id="dual-chart"></canvas></div>
                </div>
            </div>
        </div>

        <div id="tab-content-hierarchy" class="hidden fade-in space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
                <div class="lg:col-span-5 bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
                    <h2 class="text-xl font-bold text-slate-800 mb-4">ç¾åœ¨ã®ç«‹ã¡ä½ç½®ã¨å°†æ¥</h2>
                    <div class="space-y-6">
                        <div class="p-4 rounded-xl bg-slate-50 border border-slate-100">
                            <p class="text-xs font-bold text-slate-500 mb-1">ç¾åœ¨ã®è³‡ç”£ã‚¯ãƒ©ã‚¹</p>
                            <div id="current-tier-name" class="text-2xl font-bold text-slate-700">åˆ¤å®šä¸­...</div>
                            <p id="current-tier-desc" class="text-sm text-slate-500 mt-1">åˆæœŸæŠ•è³‡é¡ã«åŸºã¥ã„ã¦ã„ã¾ã™</p>
                        </div>
                        <div class="p-4 rounded-xl bg-emerald-50 border border-emerald-100">
                            <p class="text-xs font-bold text-emerald-600 mb-1">é‹ç”¨å¾Œã®åˆ°é”ã‚¯ãƒ©ã‚¹</p>
                            <div id="future-tier-name" class="text-2xl font-bold text-emerald-700">åˆ¤å®šä¸­...</div>
                            <p id="future-tier-desc" class="text-sm text-emerald-600 mt-1">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµæœã§ã™</p>
                        </div>
                        <div class="text-xs text-slate-400 leading-relaxed">
                            â€»é‡æ‘ç·åˆç ”ç©¶æ‰€ã€Œç´”é‡‘èè³‡ç”£ä¿æœ‰é¡åˆ¥ã®ä¸–å¸¯æ•°æ¨è¨ˆã€ã®åˆ†é¡ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-7 bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex flex-col items-center">
                    <h3 class="text-lg font-bold text-slate-700 mb-6 w-full text-center">è³‡ç”£éšå±¤ãƒ”ãƒ©ãƒŸãƒƒãƒ‰</h3>
                    
                    <svg viewBox="0 0 400 320" class="w-full max-w-md h-auto">
                        <path id="tier-super" d="M200 20 L240 70 H160 Z" fill="#f87171" opacity="0.3" stroke="#f87171" />
                        <text x="200" y="55" text-anchor="middle" class="pyramid-label" fill="#991b1b">è¶…å¯Œè£•å±¤ (5å„„ã€œ)</text>
                        
                        <path id="tier-rich" d="M160 72 L240 72 L275 125 H125 Z" fill="#fb923c" opacity="0.3" stroke="#fb923c" />
                        <text x="200" y="105" text-anchor="middle" class="pyramid-label" fill="#9a3412">å¯Œè£•å±¤ (1å„„ã€œ5å„„)</text>
                        
                        <path id="tier-semi" d="M125 127 L275 127 L315 185 H85 Z" fill="#fbbf24" opacity="0.3" stroke="#fbbf24" />
                        <text x="200" y="163" text-anchor="middle" class="pyramid-label" fill="#92400e">æº–å¯Œè£•å±¤ (5,000ä¸‡ã€œ1å„„)</text>
                        
                        <path id="tier-upper" d="M85 187 L315 187 L355 250 H45 Z" fill="#4ade80" opacity="0.3" stroke="#4ade80" />
                        <text x="200" y="225" text-anchor="middle" class="pyramid-label" fill="#166534">ã‚¢ãƒƒãƒ‘ãƒ¼ãƒã‚¹å±¤ (3,000ä¸‡ã€œ5,000ä¸‡)</text>
                        
                        <path id="tier-mass" d="M45 252 L355 252 L400 310 H0 Z" fill="#2dd4bf" opacity="0.3" stroke="#2dd4bf" />
                        <text x="200" y="288" text-anchor="middle" class="pyramid-label" fill="#115e59">ãƒã‚¹å±¤ (ã€œ3,000ä¸‡)</text>

                        <circle id="marker-now" cx="0" cy="0" r="5" fill="#334155" class="marker-pulse" style="display:none;" />
                        <text id="label-now" x="0" y="0" font-size="9" font-weight="bold" fill="#334155" style="display:none;">ç¾åœ¨åœ°</text>

                        <circle id="marker-future" cx="0" cy="0" r="5" fill="#15803d" class="marker-pulse" style="display:none;" />
                        <text id="label-future" x="0" y="0" font-size="9" font-weight="bold" fill="#15803d" style="display:none;">ç›®æ¨™</text>
                    </svg>
                </div>
            </div>
        </div>

        <div id="tab-content-guide" class="hidden max-w-3xl mx-auto fade-in pb-10">
            <div class="bg-white rounded-3xl p-6 md:p-10 shadow-sm border border-slate-100 space-y-8">
                <div class="text-center"><h2 class="text-2xl font-bold text-slate-800 mb-2">ğŸ”° ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2></div>
                <div class="space-y-6">
                    <div class="flex items-start"><div class="flex-shrink-0 bg-emerald-100 text-emerald-600 w-10 h-10 rounded-full flex items-center justify-center font-bold mr-4">1</div><div><h3 class="text-lg font-bold text-slate-800">1éŠ˜æŸ„ã§è¨ˆç®—ã™ã‚‹</h3><p class="text-slate-600 mt-1">åŸºæœ¬ã®ç©ç«‹è¨ˆç®—ã§ã™ã€‚ã¾ãšã¯ã“ã“ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚</p></div></div>
                    <div class="flex items-start"><div class="flex-shrink-0 bg-custom-green text-white w-10 h-10 rounded-full flex items-center justify-center font-bold mr-4">2</div><div><h3 class="text-lg font-bold text-slate-800">è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­ã‚’ç¢ºèªã™ã‚‹</h3><p class="text-slate-600 mt-1">å…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ã€å°†æ¥ã‚ãªãŸãŒã©ã®ã€Œå¯Œè£•å±¤ãƒ©ãƒ³ã‚¯ã€ã«åˆ°é”ã™ã‚‹ã‹ã‚’è‡ªå‹•åˆ¤å®šã—ã¾ã™ã€‚</p></div></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const PRODUCTS = {
            sp500: { name: 'S&P500 (ç±³å›½æ ª)', rate: 13.25, url: 'https://www.rakuten-sec.co.jp/web/fund/detail/?ID=JP90C000GKC6' },
            all:   { name: 'å…¨ä¸–ç•Œæ ªå¼ (ã‚ªãƒ«ã‚«ãƒ³)', rate: 9.99,  url: 'https://www.rakuten-sec.co.jp/web/fund/detail/?ID=JP90C000H1T1' }
        };

        const TIERS = [
            { id: 'tier-super', name: 'è¶…å¯Œè£•å±¤', min: 50000, color: '#f87171' },
            { id: 'tier-rich', name: 'å¯Œè£•å±¤', min: 10000, color: '#fb923c' },
            { id: 'tier-semi', name: 'æº–å¯Œè£•å±¤', min: 5000, color: '#fbbf24' },
            { id: 'tier-upper', name: 'ã‚¢ãƒƒãƒ‘ãƒ¼ãƒã‚¹å±¤', min: 3000, color: '#4ade80' },
            { id: 'tier-mass', name: 'ãƒã‚¹å±¤', min: 0, color: '#2dd4bf' }
        ];
        
        let currentSingleProduct = 'sp500';
        let singleChart = null;
        let dualChart = null;
        let lastResult = { initial: 0, final: 0 };

        window.onload = function() {
            selectProductSingle('sp500');
            document.getElementById('dual-sp500-month').value = 3; 
            document.getElementById('dual-all-month').value = 2;
            calculateDual();
        };

        function switchTab(tabName) {
            ['single', 'dual', 'hierarchy', 'guide'].forEach(t => {
                const btn = document.getElementById('tab-btn-' + t);
                const content = document.getElementById('tab-content-' + t);
                if(btn) btn.classList.remove('active');
                if(content) content.classList.add('hidden');
            });
            document.getElementById('tab-btn-' + tabName).classList.add('active');
            document.getElementById('tab-content-' + tabName).classList.remove('hidden');
            
            if(tabName === 'hierarchy') updateHierarchyUI();
            if(tabName === 'single' && singleChart) singleChart.resize();
            if(tabName === 'dual' && dualChart) dualChart.resize();
            window.scrollTo(0, 0);
        }

        function getTier(amountMan) {
            return TIERS.find(t => amountMan >= t.min) || TIERS[4];
        }

        function updateHierarchyUI() {
            const nowTier = getTier(lastResult.initial / 10000);
            const futureTier = getTier(lastResult.final / 10000);

            // ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
            document.getElementById('current-tier-name').innerText = nowTier.name;
            document.getElementById('current-tier-name').style.color = nowTier.color;
            document.getElementById('future-tier-name').innerText = futureTier.name;
            document.getElementById('future-tier-name').style.color = futureTier.color;

            // ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            TIERS.forEach(t => {
                const el = document.getElementById(t.id);
                el.setAttribute('opacity', '0.2');
                el.classList.remove('tier-active');
            });
            
            const nowEl = document.getElementById(nowTier.id);
            const futureEl = document.getElementById(futureTier.id);
            
            futureEl.setAttribute('opacity', '0.8');
            futureEl.classList.add('tier-active');
            nowEl.setAttribute('opacity', '0.5');

            // ãƒãƒ¼ã‚«ãƒ¼ä½ç½®ã®è¨ˆç®— (ç°¡æ˜“åº§æ¨™ãƒãƒƒãƒ—)
            const coords = {
                'tier-super': { x: 200, y: 45 },
                'tier-rich': { x: 200, y: 95 },
                'tier-semi': { x: 200, y: 155 },
                'tier-upper': { x: 200, y: 215 },
                'tier-mass': { x: 200, y: 280 }
            };

            const mNow = document.getElementById('marker-now');
            const lNow = document.getElementById('label-now');
            mNow.setAttribute('cx', coords[nowTier.id].x - 40);
            mNow.setAttribute('cy', coords[nowTier.id].y);
            lNow.setAttribute('x', coords[nowTier.id].x - 75);
            lNow.setAttribute('y', coords[nowTier.id].y + 4);
            mNow.style.display = 'block'; lNow.style.display = 'block';

            const mFuture = document.getElementById('marker-future');
            const lFuture = document.getElementById('label-future');
            mFuture.setAttribute('cx', coords[futureTier.id].x + 40);
            mFuture.setAttribute('cy', coords[futureTier.id].y);
            lFuture.setAttribute('x', coords[futureTier.id].x + 50);
            lFuture.setAttribute('y', coords[futureTier.id].y + 4);
            mFuture.style.display = 'block'; lFuture.style.display = 'block';
        }

        function formatMoney(n) {
            if(n < 0) return '-' + formatMoney(-n);
            if(n < 10000) return Math.round(n).toLocaleString() + 'å††';
            const man = Math.floor(n / 10000);
            const oku = Math.floor(man / 10000);
            const restMan = man % 10000;
            if(oku > 0) return `${oku}å„„${restMan > 0 ? restMan.toLocaleString() + 'ä¸‡' : ''}å††`;
            return `${man.toLocaleString()}ä¸‡å††`;
        }

        function checkInput(inputId, groupId) {
            const input = document.getElementById(inputId);
            const group = document.getElementById(groupId);
            if (!group) return;
            if (input.value === '' || parseFloat(input.value) <= 0) {
                 group.classList.add('bg-required');
                 group.classList.remove('bg-cleared');
            } else {
                 group.classList.remove('bg-required');
                 group.classList.add('bg-cleared');
            }
        }

        function syncInputs(fromId, toId, labelId, unit, isSingle) {
            const val = document.getElementById(fromId).value;
            document.getElementById(toId).value = val;
            if(labelId) document.getElementById(labelId).innerText = (val == 0) ? 'ãªã—' : val + unit;
            if(isSingle) calculateSingle();
            else calculateDual();
        }

        function toggleTable(contentId, arrowId) {
            const content = document.getElementById(contentId);
            const arrow = document.getElementById(arrowId);
            content.classList.toggle('hidden');
            arrow.classList.toggle('rotate-180');
        }

        function selectProductSingle(key) {
            currentSingleProduct = key;
            const p = PRODUCTS[key];
            ['sp500', 'all'].forEach(k => {
                const btn = document.getElementById('btn-single-' + k);
                btn.className = (k === key) 
                    ? "p-3 rounded-xl border-2 border-emerald-500 bg-emerald-50 text-emerald-700 shadow-sm font-bold relative"
                    : "p-3 rounded-xl border border-slate-200 bg-white text-slate-500 font-medium";
            });
            document.getElementById('single-display-rate').innerText = p.rate.toFixed(2);
            document.getElementById('single-input-rate').value = p.rate;
            document.getElementById('single-displayProduct').innerText = p.name;
            calculateSingle();
        }

        function resetSingleRate() {
            document.getElementById('single-input-rate').value = PRODUCTS[currentSingleProduct].rate;
            calculateSingle();
        }

        function calculateSingle() {
            const initial = (parseFloat(document.getElementById('single-initial').value) || 0) * 10000;
            const monthly = (parseFloat(document.getElementById('single-monthly').value) || 0) * 10000;
            const years = parseInt(document.getElementById('single-years').value) || 20;
            const rateYearly = parseFloat(document.getElementById('single-input-rate').value) || 0;
            const withdrawRate = parseFloat(document.getElementById('single-withdrawal').value) || 0;
            const rateMonthly = rateYearly / 100 / 12;
            
            let current = initial, totalInvest = initial, totalWithdraw = 0;
            const labels = ['é–‹å§‹'], dataAsset = [Math.round(current)], tableRows = [];

            for(let y=1; y<=years; y++) {
                let w = 0;
                if(withdrawRate > 0) {
                    w = current * (withdrawRate / 100);
                    current -= w;
                    totalWithdraw += w;
                }
                for(let m=0; m<12; m++) {
                    current = (current + monthly) * (1 + rateMonthly);
                    totalInvest += monthly;
                }
                labels.push(y + 'å¹´');
                dataAsset.push(Math.round(current));
                tableRows.push({ year: y + 'å¹´ç›®', col2: (withdrawRate > 0) ? w : monthly*12, asset: current });
            }
            
            lastResult = { initial: initial, final: current };
            document.getElementById('single-displayFinalAsset').innerText = formatMoney(current);
            document.getElementById('single-displayInvestment').innerText = formatMoney(totalInvest);
            document.getElementById('single-displayWithdrawn').innerText = formatMoney(totalWithdraw);
            
            const profit = current + totalWithdraw - totalInvest;
            const pEl = document.getElementById('single-displayProfit');
            pEl.innerText = (profit>=0 ? '+' : '') + formatMoney(profit);
            pEl.className = profit >= 0 ? "text-lg font-bold text-green-200" : "text-lg font-bold text-red-200";

            const tbody = document.getElementById('single-tableBody');
            tbody.innerHTML = tableRows.map(r => `<tr><td class="px-4 py-3">${r.year}</td><td class="px-4 py-3 text-right">${formatMoney(r.col2)}</td><td class="px-4 py-3 text-right font-bold text-emerald-600">${formatMoney(r.asset)}</td></tr>`).join('');
            drawChart('single-chart', labels, dataAsset, 'single');
        }

        function calculateDual() {
            const spInit = (parseFloat(document.getElementById('dual-sp500-init').value) || 0) * 10000;
            const spMonth = (parseFloat(document.getElementById('dual-sp500-month').value) || 0) * 10000;
            const spRateM = (parseFloat(document.getElementById('dual-sp500-rate').value) || 0) / 100 / 12;

            const allInit = (parseFloat(document.getElementById('dual-all-init').value) || 0) * 10000;
            const allMonth = (parseFloat(document.getElementById('dual-all-month').value) || 0) * 10000;
            const allRateM = (parseFloat(document.getElementById('dual-all-rate').value) || 0) / 100 / 12;

            const years = parseInt(document.getElementById('dual-years').value) || 20;

            let spCurrent = spInit, allCurrent = allInit;
            let totalInvest = spInit + allInit;
            const labels = ['é–‹å§‹'], dataAsset = [Math.round(spCurrent + allCurrent)];

            for(let y=1; y<=years; y++) {
                for(let m=0; m<12; m++) {
                    spCurrent = (spCurrent + spMonth) * (1 + spRateM);
                    allCurrent = (allCurrent + allMonth) * (1 + allRateM);
                    totalInvest += (spMonth + allMonth);
                }
                labels.push(y + 'å¹´');
                dataAsset.push(Math.round(spCurrent + allCurrent));
            }

            const final = spCurrent + allCurrent;
            lastResult = { initial: spInit + allInit, final: final };
            document.getElementById('dual-displayFinalAsset').innerText = formatMoney(final);
            document.getElementById('dual-displayInvestment').innerText = formatMoney(totalInvest);
            drawChart('dual-chart', labels, dataAsset, 'dual');
        }

        function drawChart(canvasId, labels, data, mode) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            if(canvasId === 'single-chart' && singleChart) singleChart.destroy();
            if(canvasId === 'dual-chart' && dualChart) dualChart.destroy();

            const borderColor = (mode === 'single') ? '#10b981' : '#15803d';
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        borderColor: borderColor,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { ticks: { callback: val => val >= 100000000 ? (val/100000000).toFixed(1) + 'å„„' : (val/10000) + 'ä¸‡' } }
                    }
                }
            });
            if(canvasId === 'single-chart') singleChart = chart;
            else dualChart = chart;
        }
    </script>
</body>
</html>
