<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã¤ã¿ãŸã¦æŠ•è³‡ãƒŠãƒ“ | è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <link rel="icon" id="dynamic-favicon">
    <link rel="apple-touch-icon" id="dynamic-apple-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800;900&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --g50:#f0fdf4;--g100:#dcfce7;--g200:#bbf7d0;--g400:#4ade80;--g500:#22c55e;--g600:#16a34a;--g700:#15803d;--g800:#166534;
            --s50:#f8fafc;--s100:#f1f5f9;--s200:#e2e8f0;--s300:#cbd5e1;--s400:#94a3b8;--s500:#64748b;--s600:#475569;--s700:#334155;--s800:#1e293b;
            --a50:#fffbeb;--a100:#fef3c7;--a200:#fde68a;--a700:#b45309;
            --r400:#f87171;--r500:#ef4444;--r600:#dc2626;
            --b50:#eff6ff;--b500:#3b82f6;--b700:#1d4ed8;--b800:#1e40af;
            --t50:#f0fdfa;--t500:#14b8a6;
            --y300:#fde047;
            --o400:#fb923c;--o700:#c2410c;
            --rad:16px;
        }
        *{box-sizing:border-box;margin:0;padding:0;}
        body{font-family:'Noto Sans JP','DM Sans',sans-serif;background:var(--s50);color:var(--s700);line-height:1.7;min-height:100vh;display:flex;flex-direction:column;-webkit-font-smoothing:antialiased;}

        .header{background:#fff;border-bottom:1px solid var(--s200);position:sticky;top:0;z-index:50;box-shadow:0 1px 2px rgba(0,0,0,.04);}
        .header-inner{max-width:1100px;margin:0 auto;padding:14px 20px 0;}
        .logo-area{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
        .logo-icon{width:34px;height:34px;background:linear-gradient(135deg,var(--g700),var(--t500));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:0 2px 8px rgba(22,163,74,.25);}
        .logo-text{font-size:1.15rem;font-weight:800;color:var(--s800);letter-spacing:-.02em;}
        .logo-sub{font-size:.62rem;color:var(--s400);font-weight:500;margin-left:6px;}

        .tab-bar{display:flex;gap:2px;overflow-x:auto;-ms-overflow-style:none;scrollbar-width:none;}
        .tab-bar::-webkit-scrollbar{display:none;}
        .tab-btn{flex:1;min-width:0;padding:9px 6px;font-weight:700;font-size:.75rem;text-align:center;border:none;background:transparent;color:var(--s400);cursor:pointer;border-bottom:3px solid transparent;transition:color .2s;white-space:nowrap;}
        .tab-btn:hover{color:var(--s600);}
        .tab-btn.active{color:var(--g700);border-bottom-color:var(--g600);}
        .tab-emoji{display:block;font-size:1rem;margin-bottom:1px;}

        .main{flex:1;max-width:1100px;width:100%;margin:0 auto;padding:20px 20px 40px;}
        .tab-content{display:none;animation:fu .35s ease-out;}
        .tab-content.active{display:block;}
        @keyframes fu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

        .sim-grid{display:grid;grid-template-columns:1fr;gap:18px;}
        @media(min-width:1024px){.sim-grid{grid-template-columns:420px 1fr;gap:24px;}}
        .col{display:flex;flex-direction:column;gap:14px;}

        .card{background:#fff;border-radius:var(--rad);padding:22px;border:1px solid var(--s200);box-shadow:0 1px 2px rgba(0,0,0,.04);}
        .card-hdr{display:flex;align-items:center;gap:9px;margin-bottom:14px;}
        .card-step{width:26px;height:26px;border-radius:50%;background:var(--g600);color:#fff;font-size:.72rem;font-weight:800;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
        .card-step.gray{background:var(--s400);}
        .card-title{font-size:.9rem;font-weight:800;color:var(--s800);}

        .product-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
        .product-btn{padding:12px 8px;border-radius:12px;border:2px solid var(--s200);background:#fff;cursor:pointer;text-align:center;transition:all .2s;position:relative;}
        .product-btn .p-name{font-weight:700;font-size:.82rem;color:var(--s600);display:block;}
        .product-btn .p-rate{font-size:.66rem;color:var(--s400);margin-top:2px;display:block;}
        .product-btn.sel{border-color:var(--g500);background:var(--g50);}
        .product-btn.sel .p-name{color:var(--g700);}
        .product-btn.sel .p-rate{color:var(--g600);}
        .product-btn.sel::after{content:'âœ“';position:absolute;top:5px;right:7px;font-size:.65rem;color:var(--g600);font-weight:800;}

        .field{margin-bottom:16px;}.field:last-child{margin-bottom:0;}
        .fl{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;}
        .fl-text{font-size:.78rem;font-weight:700;color:var(--s600);}
        .fl-val{font-size:.78rem;font-weight:700;color:var(--g600);}
        .fl-val.red{color:var(--r500);}
        .hint{font-size:.66rem;color:var(--s400);margin-top:3px;}

        .iw{display:flex;align-items:center;border:2px solid var(--s200);border-radius:11px;padding:7px 12px;background:#fff;transition:all .2s;}
        .iw:focus-within{border-color:var(--g400);box-shadow:0 0 0 3px rgba(34,197,94,.1);}
        .iw.rf:focus-within{border-color:var(--r400);box-shadow:0 0 0 3px rgba(239,68,68,.1);}
        .iw.hl{background:#fffef5;border-color:var(--a200);}
        .iw input[type="number"]{border:none;outline:none;background:transparent;width:100%;text-align:right;font-size:1.1rem;font-weight:700;color:var(--s800);font-family:'DM Sans','Noto Sans JP',sans-serif;-moz-appearance:textfield;}
        .iw input::-webkit-inner-spin-button,.iw input::-webkit-outer-spin-button{-webkit-appearance:none;}
        .iu{font-size:.78rem;font-weight:700;color:var(--s400);margin-left:5px;white-space:nowrap;}

        .rbtn{font-size:.68rem;color:var(--g600);font-weight:700;cursor:pointer;background:none;border:none;padding:2px 5px;border-radius:4px;transition:background .15s;}
        .rbtn:hover{background:var(--g50);}

        input[type="range"]{-webkit-appearance:none;width:100%;height:5px;border-radius:3px;background:var(--s200);outline:none;margin:5px 0 7px;cursor:pointer;}
        input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#fff;border:3px solid var(--g500);box-shadow:0 1px 4px rgba(0,0,0,.12);cursor:pointer;transition:transform .15s;}
        input[type="range"]::-webkit-slider-thumb:hover{transform:scale(1.12);}
        input[type="range"].rr::-webkit-slider-thumb{border-color:var(--r500);}
        input[type="range"]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#fff;border:3px solid var(--g500);box-shadow:0 1px 4px rgba(0,0,0,.12);cursor:pointer;}

        .result-hero{border-radius:var(--rad);padding:26px;color:#fff;position:relative;overflow:hidden;}
        .result-hero::before{content:'';position:absolute;top:-50%;right:-30%;width:200%;height:200%;background:radial-gradient(circle at 70% 30%,rgba(255,255,255,.07) 0%,transparent 60%);pointer-events:none;}
        .result-hero.gr{background:linear-gradient(135deg,var(--g700),#0d9488);}
        .result-hero.dg{background:linear-gradient(135deg,var(--g800),var(--g700));}
        .rl{font-size:.78rem;font-weight:600;opacity:.8;margin-bottom:3px;}
        .ra{font-size:2.3rem;font-weight:900;letter-spacing:-.03em;line-height:1.1;font-family:'DM Sans','Noto Sans JP',sans-serif;}
        @media(min-width:640px){.ra{font-size:2.8rem;}}
        .rsr{display:flex;justify-content:space-between;align-items:flex-end;margin-top:16px;flex-wrap:wrap;gap:8px;}
        .rp{font-size:1.1rem;font-weight:800;}
        .rp.pos{color:var(--y300);}.rp.neg{color:var(--r400);}
        .ri{font-size:.7rem;opacity:.7;}
        .nisa-b{display:inline-flex;align-items:center;gap:4px;background:rgba(255,255,255,.14);backdrop-filter:blur(4px);border-radius:7px;padding:3px 9px;font-size:.66rem;font-weight:700;margin-top:10px;color:#d1fae5;}
        .nisa-b .nt{color:var(--y300);font-weight:800;}

        .cc{background:#fff;border-radius:var(--rad);padding:18px;border:1px solid var(--s200);box-shadow:0 1px 2px rgba(0,0,0,.04);}
        .cc h3{font-size:.7rem;font-weight:700;color:var(--s400);margin-bottom:6px;}
        .cl{display:flex;gap:14px;margin-bottom:6px;flex-wrap:wrap;}
        .cli{display:flex;align-items:center;gap:4px;font-size:.68rem;font-weight:600;color:var(--s500);}
        .cld{width:9px;height:9px;border-radius:2px;}
        .cw{position:relative;height:270px;width:100%;}

        .dtb{font-size:.76rem;font-weight:700;color:var(--g600);cursor:pointer;background:none;border:none;padding:6px 0;display:flex;align-items:center;gap:5px;}
        .dtb .arr{transition:transform .2s;font-size:.6rem;}
        .dtb.open .arr{transform:rotate(90deg);}
        .dtw{display:none;margin-top:6px;max-height:280px;overflow-y:auto;border:1px solid var(--s200);border-radius:10px;}
        .dtw.show{display:block;}
        .dt{width:100%;border-collapse:collapse;font-size:.7rem;}
        .dt th{background:var(--s50);font-weight:700;color:var(--s500);padding:7px 8px;text-align:right;position:sticky;top:0;border-bottom:1px solid var(--s200);}
        .dt th:first-child{text-align:center;}
        .dt td{padding:6px 8px;text-align:right;border-bottom:1px solid var(--s100);color:var(--s600);font-family:'DM Sans',sans-serif;font-weight:500;}
        .dt td:first-child{text-align:center;color:var(--s400);font-weight:600;}
        .dt tr:last-child td{border-bottom:none;}
        .dt tr:hover td{background:var(--g50);}

        .disc{background:var(--s50);border:1px solid var(--s200);border-radius:11px;padding:12px 14px;margin-top:14px;}
        .disc-t{font-size:.7rem;font-weight:700;color:var(--s500);margin-bottom:3px;display:flex;align-items:center;gap:4px;}
        .disc p{font-size:.64rem;color:var(--s400);line-height:1.6;}

        .dpc{border-radius:14px;padding:18px;border:1px solid;margin-bottom:10px;}
        .dpc:last-of-type{margin-bottom:0;}
        .dpc.usa{background:var(--b50);border-color:#bfdbfe;}
        .dpc.world{background:var(--t50);border-color:#99f6e4;}
        .dpt{font-weight:800;font-size:.88rem;margin-bottom:10px;display:flex;align-items:center;gap:5px;}
        .dpc.usa .dpt{color:var(--b800);}
        .dpc.world .dpt{color:var(--g800);}
        .df{margin-bottom:10px;}.df:last-child{margin-bottom:0;}
        .df label{font-size:.7rem;font-weight:700;display:block;margin-bottom:3px;}
        .dpc.usa .df label{color:var(--b700);}
        .dpc.world .df label{color:var(--g700);}
        .diw{display:flex;align-items:center;background:#fff;border:1px solid;border-radius:9px;padding:5px 10px;}
        .dpc.usa .diw{border-color:#bfdbfe;}
        .dpc.world .diw{border-color:#99f6e4;}
        .diw input{border:none;outline:none;background:transparent;width:100%;text-align:right;font-size:.95rem;font-weight:700;color:var(--s800);font-family:'DM Sans','Noto Sans JP',sans-serif;-moz-appearance:textfield;}
        .diw input::-webkit-inner-spin-button,.diw input::-webkit-outer-spin-button{-webkit-appearance:none;}
        .diw .u{font-size:.7rem;font-weight:700;color:var(--s400);margin-left:4px;white-space:nowrap;}

        .trow{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:9px 0;}
        .tlbl{font-size:.76rem;font-weight:700;color:var(--s600);display:flex;align-items:center;gap:4px;}
        .tsw{position:relative;width:42px;height:22px;background:var(--s300);border-radius:11px;cursor:pointer;transition:background .2s;flex-shrink:0;}
        .tsw.on{background:var(--g500);}
        .tsw .tk{position:absolute;top:2px;left:2px;width:18px;height:18px;background:#fff;border-radius:50%;transition:transform .2s;box-shadow:0 1px 3px rgba(0,0,0,.15);}
        .tsw.on .tk{transform:translateX(20px);}

        .tt{display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:var(--s200);color:var(--s500);font-size:.52rem;font-weight:800;cursor:help;margin-left:3px;position:relative;vertical-align:middle;}
        .tt .tc{display:none;position:absolute;bottom:calc(100% + 7px);left:50%;transform:translateX(-50%);background:var(--s800);color:#fff;padding:7px 10px;border-radius:7px;font-size:.66rem;font-weight:500;width:max-content;max-width:220px;line-height:1.5;z-index:100;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,.1);}
        .tt .tc::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:4px solid transparent;border-top-color:var(--s800);}
        .tt:hover .tc,.tt:focus .tc{display:block;}

        .hgrid{display:grid;grid-template-columns:1fr;gap:22px;align-items:center;}
        @media(min-width:768px){.hgrid{grid-template-columns:1fr 1fr;}}
        .pw{display:flex;justify-content:center;}
        .pw svg{width:100%;max-width:370px;filter:drop-shadow(0 2px 8px rgba(0,0,0,.05));}
        .ti{display:flex;flex-direction:column;gap:14px;}
        .tr{display:flex;justify-content:space-between;align-items:center;padding-bottom:10px;border-bottom:1px solid var(--s200);}
        .trl{font-size:.76rem;font-weight:700;}
        .trl.nw{color:var(--s500);}.trl.ft{color:var(--g600);}
        .trv{font-weight:800;}
        .trv.nw{color:var(--s700);font-size:.95rem;}.trv.ft{color:var(--g700);font-size:1.15rem;}
        .ps{margin-top:3px;}
        .pl{display:flex;justify-content:space-between;margin-bottom:5px;}
        .pl span{font-size:.7rem;font-weight:700;}
        .pbb{width:100%;height:9px;background:var(--s200);border-radius:5px;overflow:hidden;}
        .pbf{height:100%;background:linear-gradient(90deg,var(--g400),var(--g600));border-radius:5px;transition:width .8s ease;}
        .pt{font-size:.66rem;color:var(--s400);text-align:right;margin-top:3px;}

        .acard{background:linear-gradient(135deg,var(--a50),#fff9eb);border-radius:var(--rad);padding:22px;border:1px solid var(--a200);margin-top:18px;}
        .at{font-size:.95rem;font-weight:800;color:var(--a700);margin-bottom:14px;display:flex;align-items:center;gap:7px;}
        .ag{display:grid;grid-template-columns:1fr;gap:10px;}
        @media(min-width:640px){.ag{grid-template-columns:1fr 1fr;}}
        .ab{background:#fff;border-radius:12px;padding:14px;border:1px solid var(--a100);}
        .abl{font-size:.68rem;font-weight:700;color:var(--s500);margin-bottom:4px;}
        .abv{font-size:.85rem;color:var(--s700);line-height:1.6;}
        .ahl{font-size:1.2rem;font-weight:800;color:var(--g600);}

        .gs{display:grid;gap:16px;}
        .gi{background:#fff;border-radius:14px;padding:18px;border:1px solid var(--s200);}
        .gi h3{font-size:.88rem;font-weight:800;color:var(--s800);margin-bottom:6px;}
        .gi p{font-size:.8rem;color:var(--s500);line-height:1.7;}
        .gcall{background:var(--g50);border:1px solid var(--g200);border-radius:11px;padding:14px;margin-top:16px;}
        .gcall h4{font-size:.8rem;font-weight:800;color:var(--g700);margin-bottom:4px;}
        .gcall p{font-size:.74rem;color:var(--g600);line-height:1.6;}

        .footer{text-align:center;padding:16px;font-size:.66rem;color:var(--s400);border-top:1px solid var(--s200);background:#fff;}
    </style>
</head>
<body>
<header class="header">
    <div class="header-inner">
        <div class="logo-area">
            <div class="logo-icon">ğŸ“ˆ</div>
            <div><span class="logo-text">ã¤ã¿ãŸã¦æŠ•è³‡ãƒŠãƒ“</span><span class="logo-sub">è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</span></div>
        </div>
        <nav class="tab-bar">
            <button class="tab-btn active" data-tab="single" onclick="saveTab('single')"><span class="tab-emoji">ğŸ“Š</span>1éŠ˜æŸ„ã§è¨ˆç®—</button>
            <button class="tab-btn" data-tab="dual" onclick="saveTab('dual')"><span class="tab-emoji">ğŸ“ŠğŸ“Š</span>2éŠ˜æŸ„ã§æ¯”è¼ƒ</button>
            <button class="tab-btn" data-tab="hierarchy" onclick="saveTab('hierarchy')"><span class="tab-emoji">ğŸ†</span>è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­</button>
            <button class="tab-btn" data-tab="guide" onclick="saveTab('guide')"><span class="tab-emoji">ğŸ“–</span>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>
        </nav>
    </div>
</header>

<main class="main">

<section class="tab-content active" id="tab-single">
<div class="sim-grid">
<div class="col">
    <div class="card">
        <div class="card-hdr"><div class="card-step">1</div><div class="card-title">é‹ç”¨å•†å“ã‚’é¸ã¶</div></div>
        <div class="product-grid">
            <button class="product-btn sel" id="btn-s-sp" onclick="selProd('sp500')"><span class="p-name">ğŸ‡ºğŸ‡¸ S&P500</span><span class="p-rate">ç±³å›½å¤§å‹æ ª500ç¤¾</span></button>
            <button class="product-btn" id="btn-s-al" onclick="selProd('all')"><span class="p-name">ğŸŒ å…¨ä¸–ç•Œæ ªå¼</span><span class="p-rate">ã‚ªãƒ«ã‚«ãƒ³ï¼ˆå…ˆé€²+æ–°èˆˆå›½ï¼‰</span></button>
        </div>
    </div>
    <div class="card">
        <div class="card-hdr"><div class="card-step">2</div><div class="card-title">é‡‘é¡ãƒ»æœŸé–“ã‚’å…¥åŠ›ã™ã‚‹</div></div>
        <div class="field">
            <div class="fl">
                <span class="fl-text">æƒ³å®šåˆ©å›ã‚Šï¼ˆå¹´ç‡ï¼‰<span class="tt" tabindex="0">?<span class="tc">éå»ã®å¹³å‡ãƒªã‚¿ãƒ¼ãƒ³ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºã€‚å°†æ¥ã®åˆ©å›ã‚Šã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</span></span></span>
                <button class="rbtn" onclick="resetRate()">å¹³å‡å€¤ã«æˆ»ã™</button>
            </div>
            <div class="iw"><input type="number" id="s-rate" value="13.25" step="0.01" oninput="saveAndCalc()" onfocus="this.select()"><span class="iu">%</span></div>
            <div class="hint" id="s-rate-src">â€» S&P500ã®éå»30å¹´é–“ï¼ˆ1994ã€œ2024ï¼‰ã®å¹´å¹³å‡ãƒªã‚¿ãƒ¼ãƒ³</div>
        </div>
        <div class="field">
            <div class="fl"><span class="fl-text">åˆæœŸæŠ•è³‡é¡ï¼ˆã¾ã¨ã¾ã£ãŸãŠé‡‘ï¼‰</span></div>
            <div class="iw hl" id="s-init-w"><input type="number" id="s-init" placeholder="0" oninput="onIn('s-init','s-init-w');saveAndCalc()"><span class="iu">ä¸‡å††</span></div>
        </div>
        <div class="field">
            <div class="fl"><span class="fl-text">æ¯æœˆã®ç©ç«‹é¡</span><span class="fl-val" id="s-mo-v">3ä¸‡å††</span></div>
            <input type="range" id="s-mo-r" min="0" max="30" value="3" oninput="sR('s-mo')">
            <div class="iw"><input type="number" id="s-mo" value="3" oninput="sI('s-mo');saveAndCalc()"><span class="iu">ä¸‡å††</span></div>
            <div class="hint">â€» æ–°NISAã¤ã¿ãŸã¦æŠ•è³‡æ : æœˆ10ä¸‡å††ã¾ã§éèª²ç¨</div>
        </div>
        <div class="field">
            <div class="fl"><span class="fl-text">é‹ç”¨æœŸé–“</span><span class="fl-val" id="s-yr-v">20å¹´</span></div>
            <input type="range" id="s-yr-r" min="1" max="50" value="20" oninput="sR('s-yr')">
            <div class="iw"><input type="number" id="s-yr" value="20" oninput="sI('s-yr');saveAndCalc()"><span class="iu">å¹´</span></div>
        </div>
    </div>
    <div class="card">
        <div class="card-hdr"><div class="card-step gray">3</div><div class="card-title" style="color:var(--s500)">ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š</div></div>
        <div class="field">
            <div class="fl"><span class="fl-text">æ¯å¹´ã®å–ã‚Šå´©ã—ç‡<span class="tt" tabindex="0">?<span class="tc">å¹´æœ«ã«è³‡ç”£ã®ä¸€å®šå‰²åˆã‚’å¼•ãå‡ºã™è¨­å®šã€‚ã€Œ4%ãƒ«ãƒ¼ãƒ«ã€ã¯æœ‰åãªãƒªã‚¿ã‚¤ã‚¢æˆ¦ç•¥ã§ã™ã€‚</span></span></span><span class="fl-val red" id="s-wd-v">0%</span></div>
            <input type="range" id="s-wd-r" min="0" max="20" value="0" step="0.1" class="rr" oninput="sR('s-wd')">
            <div class="iw rf"><input type="number" id="s-wd" value="0" step="0.1" oninput="sI('s-wd');saveAndCalc()" onfocus="this.select()"><span class="iu">%</span></div>
            <div class="hint">â€» å¹´æœ«ã«ä¸€æ‹¬ã§å–ã‚Šå´©ã™è¨ˆç®—ã§ã™</div>
        </div>
        <div class="trow">
            <span class="tlbl">NISAæ ã§éèª²ç¨ã¨ä»®å®š<span class="tt" tabindex="0">?<span class="tc">OFFã«ã™ã‚‹ã¨é‹ç”¨ç›Šã«20.315%ã®ç¨é‡‘ãŒã‹ã‹ã‚Šã¾ã™ï¼ˆç‰¹å®šå£åº§ï¼‰ã€‚</span></span></span>
            <div class="tsw on" id="s-nisa" onclick="tgN('s')"><div class="tk"></div></div>
        </div>
    </div>
</div>
<div class="col">
    <div class="result-hero gr" id="s-rh">
        <p class="rl">æœ€çµ‚è³‡ç”£æ®‹é«˜</p>
        <div class="ra" id="s-final">0å††</div>
        <div class="rsr">
            <div><p style="font-size:.66rem;opacity:.7">é‹ç”¨åç›Šï¼ˆåˆ©ç›Šï¼‰</p><p class="rp pos" id="s-profit">+0å††</p></div>
            <p class="ri">æŠ•è³‡å…ƒæœ¬: <span id="s-inv">0å††</span></p>
        </div>
        <div class="nisa-b" id="s-nb"><span id="s-nb-l">ğŸ›ï¸ NISAéèª²ç¨</span><span class="nt" id="s-tax">ç¯€ç¨é¡: 0å††</span></div>
    </div>
    <div class="cc">
        <h3>è³‡ç”£æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
        <div class="cl">
            <span class="cli"><span class="cld" style="background:var(--g500)"></span>è³‡ç”£æ®‹é«˜</span>
            <span class="cli"><span class="cld" style="background:var(--s300)"></span>æŠ•è³‡å…ƒæœ¬</span>
        </div>
        <div class="cw"><canvas id="s-chart"></canvas></div>
    </div>
    <div class="cc">
        <button class="dtb" id="s-dtb" onclick="tgD('s')"><span class="arr">â–¶</span> å¹´åˆ¥ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹</button>
        <div class="dtw" id="s-dtw"><table class="dt"><thead><tr><th>å¹´</th><th>æŠ•è³‡å…ƒæœ¬</th><th>è³‡ç”£æ®‹é«˜</th><th>é‹ç”¨ç›Š</th><th>å–å´©é¡</th></tr></thead><tbody id="s-dtbody"></tbody></table></div>
    </div>
    <div class="disc"><div class="disc-t">âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</div><p>æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯éå»ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãä»®æƒ³è¨ˆç®—ã§ã‚ã‚Šã€å°†æ¥ã®æˆæœã‚’ä¿è¨¼ã—ã¾ã›ã‚“ã€‚å¸‚å ´å¤‰å‹•ã«ã‚ˆã‚Šå…ƒæœ¬å‰²ã‚Œã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚åˆ©å›ã‚Šå‡ºå…¸ï¼šS&P Dow Jones Indices / MSCI ACWI Index å…¬é–‹ãƒ‡ãƒ¼ã‚¿å‚è€ƒã€‚</p></div>
</div>
</div>
</section>

<section class="tab-content" id="tab-dual">
<div class="sim-grid">
<div class="col">
    <div class="card">
        <div class="card-hdr"><div class="card-step">1</div><div class="card-title">éŠ˜æŸ„ã”ã¨ã®é‡‘é¡ã‚’æ±ºã‚ã‚‹</div></div>
        <div class="dpc usa">
            <div class="dpt">ğŸ‡ºğŸ‡¸ S&P500ï¼ˆç±³å›½æ ªï¼‰</div>
            <div class="df"><div style="display:flex;justify-content:space-between;align-items:center"><label>æƒ³å®šåˆ©å›ã‚Š</label><button class="rbtn" onclick="rDR('sp500')">å¹³å‡å€¤ã«æˆ»ã™</button></div><div class="diw"><input type="number" id="d-sp-r" value="13.25" step="0.01" oninput="saveAndCD()" onfocus="this.select()"><span class="u">%</span></div></div>
            <div class="df"><label>åˆæœŸæŠ•è³‡é¡</label><div class="diw"><input type="number" id="d-sp-i" placeholder="0" oninput="saveAndCD()"><span class="u">ä¸‡å††</span></div></div>
            <div class="df"><label>æ¯æœˆã®ç©ç«‹é¡</label><div class="diw"><input type="number" id="d-sp-m" value="3" oninput="saveAndCD()"><span class="u">ä¸‡å††</span></div></div>
        </div>
        <div class="dpc world">
            <div class="dpt">ğŸŒ å…¨ä¸–ç•Œæ ªå¼ï¼ˆã‚ªãƒ«ã‚«ãƒ³ï¼‰</div>
            <div class="df"><div style="display:flex;justify-content:space-between;align-items:center"><label>æƒ³å®šåˆ©å›ã‚Š</label><button class="rbtn" onclick="rDR('all')">å¹³å‡å€¤ã«æˆ»ã™</button></div><div class="diw"><input type="number" id="d-al-r" value="9.99" step="0.01" oninput="saveAndCD()" onfocus="this.select()"><span class="u">%</span></div></div>
            <div class="df"><label>åˆæœŸæŠ•è³‡é¡</label><div class="diw"><input type="number" id="d-al-i" placeholder="0" oninput="saveAndCD()"><span class="u">ä¸‡å††</span></div></div>
            <div class="df"><label>æ¯æœˆã®ç©ç«‹é¡</label><div class="diw"><input type="number" id="d-al-m" value="2" oninput="saveAndCD()"><span class="u">ä¸‡å††</span></div></div>
        </div>
    </div>
    <div class="card">
        <div class="card-hdr"><div class="card-step">2</div><div class="card-title">å…±é€šè¨­å®š</div></div>
        <div class="field">
            <div class="fl"><span class="fl-text">é‹ç”¨æœŸé–“</span><span class="fl-val" id="d-yr-v">20å¹´</span></div>
            <input type="range" id="d-yr-r" min="1" max="50" value="20" oninput="sR('d-yr')">
            <div class="iw"><input type="number" id="d-yr" value="20" oninput="sI('d-yr');saveAndCD()"><span class="iu">å¹´</span></div>
        </div>
        <div class="field">
            <div class="fl"><span class="fl-text">æ¯å¹´ã®å–ã‚Šå´©ã—ç‡ <span style="font-weight:400;color:var(--s400);font-size:.68rem">(ä»»æ„)</span></span><span class="fl-val red" id="d-wd-v">0%</span></div>
            <input type="range" id="d-wd-r" min="0" max="20" value="0" step="0.1" class="rr" oninput="sR('d-wd')">
            <div class="iw rf"><input type="number" id="d-wd" value="0" step="0.1" oninput="sI('d-wd');saveAndCD()" onfocus="this.select()"><span class="iu">%</span></div>
        </div>
        <div class="trow">
            <span class="tlbl">NISAæ ã§éèª²ç¨ã¨ä»®å®š<span class="tt" tabindex="0">?<span class="tc">OFFã§é‹ç”¨ç›Šã«20.315%èª²ç¨ã€‚</span></span></span>
            <div class="tsw on" id="d-nisa" onclick="tgN('d')"><div class="tk"></div></div>
        </div>
    </div>
</div>
<div class="col">
    <div class="result-hero dg">
        <p class="rl">æœ€çµ‚è³‡ç”£æ®‹é«˜ï¼ˆ2éŠ˜æŸ„åˆè¨ˆï¼‰</p>
        <div class="ra" id="d-final">0å††</div>
        <div class="rsr">
            <div><p style="font-size:.66rem;opacity:.7">é‹ç”¨åç›Šï¼ˆåˆ©ç›Šï¼‰</p><p class="rp pos" id="d-profit">+0å††</p></div>
            <p class="ri">å…ƒæœ¬åˆè¨ˆ: <span id="d-inv">0å††</span></p>
        </div>
        <div class="nisa-b" id="d-nb"><span id="d-nb-l">ğŸ›ï¸ NISAéèª²ç¨</span><span class="nt" id="d-tax">ç¯€ç¨é¡: 0å††</span></div>
    </div>
    <div class="cc">
        <h3>è³‡ç”£æ¨ç§»ã‚°ãƒ©ãƒ•ï¼ˆ2éŠ˜æŸ„åˆè¨ˆï¼‰</h3>
        <div class="cl">
            <span class="cli"><span class="cld" style="background:var(--g500)"></span>åˆè¨ˆ</span>
            <span class="cli"><span class="cld" style="background:var(--b500)"></span>S&P500</span>
            <span class="cli"><span class="cld" style="background:var(--t500)"></span>å…¨ä¸–ç•Œ</span>
            <span class="cli"><span class="cld" style="background:var(--s300)"></span>å…ƒæœ¬</span>
        </div>
        <div class="cw"><canvas id="d-chart"></canvas></div>
    </div>
    <div class="cc">
        <button class="dtb" id="d-dtb" onclick="tgD('d')"><span class="arr">â–¶</span> å¹´åˆ¥ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹</button>
        <div class="dtw" id="d-dtw"><table class="dt"><thead><tr><th>å¹´</th><th>å…ƒæœ¬</th><th>S&P500</th><th>å…¨ä¸–ç•Œ</th><th>åˆè¨ˆ</th></tr></thead><tbody id="d-dtbody"></tbody></table></div>
    </div>
    <div class="disc"><div class="disc-t">âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</div><p>ä»®æƒ³è¨ˆç®—ã§ã‚ã‚Šå°†æ¥ã®æˆæœã‚’ä¿è¨¼ã—ã¾ã›ã‚“ã€‚å…ƒæœ¬å‰²ã‚Œãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚æŠ•è³‡åˆ¤æ–­ã¯ã”è‡ªèº«ã®è²¬ä»»ã§ã€‚</p></div>
</div>
</div>
</section>

<section class="tab-content" id="tab-hierarchy">
<div class="card" style="margin-bottom:18px;">
    <h2 style="font-size:1.05rem;font-weight:800;color:var(--s800);text-align:center;margin-bottom:6px;">è³‡ç”£éšå±¤ãƒ”ãƒ©ãƒŸãƒƒãƒ‰è¨ºæ–­</h2>
    <p style="text-align:center;font-size:.72rem;color:var(--s400);margin-bottom:20px;">é‡æ‘ç·åˆç ”ç©¶æ‰€ã®è³‡ç”£éšå±¤åˆ†é¡ã«åŸºã¥ãåˆ¤å®š</p>
    <div class="hgrid">
        <div class="pw">
            <svg viewBox="0 0 400 330">
                <defs>
                    <linearGradient id="gs" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#fca5a5"/><stop offset="100%" stop-color="#f87171"/></linearGradient>
                    <linearGradient id="gr" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#fed7aa"/><stop offset="100%" stop-color="#fb923c"/></linearGradient>
                    <linearGradient id="gm" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#fef08a"/><stop offset="100%" stop-color="#fbbf24"/></linearGradient>
                    <linearGradient id="gu" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#bbf7d0"/><stop offset="100%" stop-color="#4ade80"/></linearGradient>
                    <linearGradient id="gma" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#99f6e4"/><stop offset="100%" stop-color="#2dd4bf"/></linearGradient>
                </defs>
                <path id="py-super" d="M200 20 L240 72 H160 Z" fill="url(#gs)" opacity=".35" stroke="#fff" stroke-width="2"/>
                <text x="200" y="55" text-anchor="middle" font-size="9" fill="#b91c1c" font-weight="bold">è¶…å¯Œè£•å±¤</text><text x="200" y="65" text-anchor="middle" font-size="7" fill="#b91c1c" opacity=".7">5å„„å††ã€œ</text>
                <path id="py-rich" d="M160 74 L240 74 L278 130 H122 Z" fill="url(#gr)" opacity=".35" stroke="#fff" stroke-width="2"/>
                <text x="200" y="108" text-anchor="middle" font-size="9" fill="#c2410c" font-weight="bold">å¯Œè£•å±¤</text><text x="200" y="118" text-anchor="middle" font-size="7" fill="#c2410c" opacity=".7">1å„„ã€œ5å„„å††</text>
                <path id="py-semi" d="M122 132 L278 132 L318 192 H82 Z" fill="url(#gm)" opacity=".35" stroke="#fff" stroke-width="2"/>
                <text x="200" y="168" text-anchor="middle" font-size="9" fill="#b45309" font-weight="bold">æº–å¯Œè£•å±¤</text><text x="200" y="178" text-anchor="middle" font-size="7" fill="#b45309" opacity=".7">5000ä¸‡ã€œ1å„„å††</text>
                <path id="py-upper" d="M82 194 L318 194 L358 258 H42 Z" fill="url(#gu)" opacity=".35" stroke="#fff" stroke-width="2"/>
                <text x="200" y="232" text-anchor="middle" font-size="9" fill="#15803d" font-weight="bold">ã‚¢ãƒƒãƒ‘ãƒ¼ãƒã‚¹å±¤</text><text x="200" y="242" text-anchor="middle" font-size="7" fill="#15803d" opacity=".7">3000ä¸‡ã€œ5000ä¸‡å††</text>
                <path id="py-mass" d="M42 260 L358 260 L400 320 H0 Z" fill="url(#gma)" opacity=".35" stroke="#fff" stroke-width="2"/>
                <text x="200" y="296" text-anchor="middle" font-size="9" fill="#0f766e" font-weight="bold">ãƒã‚¹å±¤</text><text x="200" y="306" text-anchor="middle" font-size="7" fill="#0f766e" opacity=".7">ã€œ3000ä¸‡å††</text>
                <g id="a-now"><text x="60" y="0" text-anchor="end" font-size="12" font-weight="bold" fill="#94a3b8">ç¾åœ¨</text><path d="M75 -4 L95 -4 L95 -9 L110 0 L95 9 L95 4 L75 4 Z" fill="#94a3b8"/></g>
                <g id="a-fut"><text x="340" y="0" text-anchor="start" font-size="12" font-weight="bold" fill="#15803d">å°†æ¥</text><path d="M325 -4 L305 -4 L305 -9 L290 0 L305 9 L305 4 L325 4 Z" fill="#15803d"/></g>
            </svg>
        </div>
        <div class="ti">
            <div class="tr"><span class="trl nw">ğŸ“ ç¾åœ¨ã®éšå±¤</span><span class="trv nw" id="h-now">--</span></div>
            <div class="tr" style="border-color:var(--g200)"><span class="trl ft">ğŸ¯ å°†æ¥ã®éšå±¤</span><span class="trv ft" id="h-fut">--</span></div>
            <div class="ps">
                <div class="pl"><span style="color:var(--s500)">NEXT RANKã¾ã§</span><span style="color:var(--g600)" id="h-gap">ã‚ã¨ --ä¸‡å††</span></div>
                <div class="pbb"><div class="pbf" id="h-prog" style="width:0%"></div></div>
                <p class="pt" id="h-tgt">ç›®æ¨™: --ä¸‡å††</p>
            </div>
        </div>
    </div>
</div>
<div class="acard">
    <div class="at">âš¡ æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸è¡Œãã«ã¯ï¼Ÿ</div>
    <div class="ag">
        <div class="ab" id="adv-t"></div>
        <div class="ab" id="adv-m"></div>
    </div>
</div>
</section>

<section class="tab-content" id="tab-guide">
<div class="gs">
    <div class="gi"><h3>ğŸ“Š 1éŠ˜æŸ„ã§è¨ˆç®—</h3><p>S&P500ã¾ãŸã¯å…¨ä¸–ç•Œæ ªå¼ã‚’é¸ã‚“ã§ã€åˆæœŸæŠ•è³‡é¡ãƒ»æ¯æœˆã®ç©ç«‹é¡ãƒ»é‹ç”¨æœŸé–“ã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã€‚ã™ãã«è³‡ç”£æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•ã§ç¢ºèªã§ãã¾ã™ã€‚æŠ•è³‡åˆå¿ƒè€…ã®æ–¹ã¯ã¾ãšã“ã“ã‹ã‚‰ã€‚</p></div>
    <div class="gi"><h3>ğŸ“ŠğŸ“Š 2éŠ˜æŸ„ã§æ¯”è¼ƒ</h3><p>ã€ŒS&P500ã«æœˆ3ä¸‡ã€å…¨ä¸–ç•Œæ ªå¼ã«æœˆ2ä¸‡ã€ã®ã‚ˆã†ã«ã€2å•†å“ã‚’çµ„ã¿åˆã‚ã›ãŸã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚åˆ†æ•£æŠ•è³‡ã®åŠ¹æœã‚’ç¢ºèªã—ãŸã„æ–¹ã«ã€‚</p></div>
    <div class="gi"><h3>ğŸ† è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­</h3><p>é‡æ‘ç·åˆç ”ç©¶æ‰€ã®å®šç¾©ã«åŸºã¥ãã€Œè³‡ç”£éšå±¤ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã€ã§ç¾åœ¨ã¨å°†æ¥ã®ä½ç½®ã‚’è¨ºæ–­ã€‚ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã®ãŸã‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p></div>
    <div class="gi"><h3>ğŸ’¡ åˆ©å›ã‚Šã®æ•°å­—ã«ã¤ã„ã¦</h3><p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åˆ©å›ã‚Šã¯éå»ã®å®Ÿç¸¾å¹³å‡ã§ã™ã€‚S&P500ã¯éå»30å¹´ã§å¹´å¹³å‡ç´„13%ã®ãƒªã‚¿ãƒ¼ãƒ³ãŒã‚ã‚Šã¾ã—ãŸãŒã€é€”ä¸­ã§-37%ï¼ˆ2008å¹´ãƒªãƒ¼ãƒãƒ³ã‚·ãƒ§ãƒƒã‚¯ï¼‰ã®ã‚ˆã†ãªå¤§æš´è½ã‚‚çµŒé¨“ã—ã¦ã„ã¾ã™ã€‚é•·æœŸæŠ•è³‡ã ã‹ã‚‰ã“ãã€ä¸€æ™‚çš„ãªä¸‹è½ã«è€ãˆã‚‰ã‚Œã‚‹ä½™è£•è³‡é‡‘ã§é‹ç”¨ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚</p></div>
    <div class="gi"><h3>ğŸ›ï¸ ç¨é‡‘ï¼ˆNISAï¼‰ã«ã¤ã„ã¦</h3><p>æ–°NISAã§ã¯å¹´é–“360ä¸‡å††ï¼ˆã¤ã¿ãŸã¦æŠ•è³‡æ 120ä¸‡+æˆé•·æŠ•è³‡æ 240ä¸‡ï¼‰ã€ç”Ÿæ¶¯æŠ•è³‡æ 1800ä¸‡å††ã¾ã§éèª²ç¨ã§é‹ç”¨ã§ãã¾ã™ã€‚æœ¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã¯ã€ŒNISAéèª²ç¨ã€ã‚’ON/OFFã§åˆ‡ã‚Šæ›¿ãˆã€èª²ç¨å£åº§ï¼ˆ20.315%ï¼‰ã¨ã®å·®ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p></div>
    <div class="gcall"><h4>ğŸ”° æŠ•è³‡åˆå¿ƒè€…ã¸ã®ãƒ¯ãƒ³ãƒã‚¤ãƒ³ãƒˆ</h4><p>ã€Œã„ãã‚‰å¢—ãˆã‚‹ã‹ã€ã‚ˆã‚Šå¤§åˆ‡ãªã®ã¯ã€Œæš´è½æ™‚ã«ã‚‚ç¶šã‘ã‚‰ã‚Œã‚‹ã‹ã€ã§ã™ã€‚ç„¡ç†ã®ãªã„é‡‘é¡ã‚’è¨­å®šã—ã€æœ€ä½15å¹´ä»¥ä¸Šã®é•·æœŸç›®ç·šã§ã€‚éå»ã®ãƒ‡ãƒ¼ã‚¿ã§ã¯ã€S&P500ã«15å¹´ä»¥ä¸ŠæŠ•è³‡ã—ãŸå ´åˆã€ã©ã®æ™‚æœŸã«å§‹ã‚ã¦ã‚‚å…ƒæœ¬å‰²ã‚Œã—ãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p></div>
</div>
</section>

</main>
<footer class="footer">æœ¬ãƒ„ãƒ¼ãƒ«ã¯æƒ…å ±æä¾›ã®ã¿ã‚’ç›®çš„ã¨ã—ã¦ãŠã‚Šã€æŠ•è³‡åŠ©è¨€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•è³‡ã¯ã”è‡ªèº«ã®åˆ¤æ–­ã¨è²¬ä»»ã§è¡Œã£ã¦ãã ã•ã„ã€‚</footer>

<script>
const P={sp500:{name:'S&P500',rate:13.25,src:'â€» S&P500ã®éå»30å¹´é–“ï¼ˆ1994ã€œ2024ï¼‰ã®å¹´å¹³å‡ãƒªã‚¿ãƒ¼ãƒ³'},all:{name:'å…¨ä¸–ç•Œæ ªå¼',rate:9.99,src:'â€» MSCI ACWI Indexã®éå»30å¹´é–“ã®å¹´å¹³å‡ãƒªã‚¿ãƒ¼ãƒ³'}};
const T=[{id:'py-super',name:'è¶…å¯Œè£•å±¤',min:50000,y:46},{id:'py-rich',name:'å¯Œè£•å±¤',min:10000,y:102},{id:'py-semi',name:'æº–å¯Œè£•å±¤',min:5000,y:162},{id:'py-upper',name:'ã‚¢ãƒƒãƒ‘ãƒ¼ãƒã‚¹å±¤',min:3000,y:226},{id:'py-mass',name:'ãƒã‚¹å±¤',min:0,y:290}];
const TAX=.20315;
let cProd='sp500',sC=null,dC=null,nS=true,nD=true;
let LR={initial:0,final:0,profit:0,inputs:{rate:0,monthly:0,years:0,initial:0}};

// === Local Storage é–¢é€£ã®å‡¦ç†ã‚’è¿½åŠ  ===
const STORAGE_KEY = 'investmentSimData';

function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        try {
            const data = JSON.parse(saved);
            
            // Single
            if(data.s) {
                if(data.s.prod) selProd(data.s.prod);
                if(data.s.rate !== undefined) document.getElementById('s-rate').value = data.s.rate;
                if(data.s.init !== undefined) document.getElementById('s-init').value = data.s.init;
                if(data.s.mo !== undefined) {
                    document.getElementById('s-mo').value = data.s.mo;
                    document.getElementById('s-mo-r').value = data.s.mo;
                    sI('s-mo');
                }
                if(data.s.yr !== undefined) {
                    document.getElementById('s-yr').value = data.s.yr;
                    document.getElementById('s-yr-r').value = data.s.yr;
                    sI('s-yr');
                }
                if(data.s.wd !== undefined) {
                    document.getElementById('s-wd').value = data.s.wd;
                    document.getElementById('s-wd-r').value = data.s.wd;
                    sI('s-wd');
                }
                if(data.s.nisa !== undefined) {
                    nS = data.s.nisa;
                    document.getElementById('s-nisa').classList.toggle('on', nS);
                }
            }

            // Dual
            if(data.d) {
                if(data.d.sp_r !== undefined) document.getElementById('d-sp-r').value = data.d.sp_r;
                if(data.d.sp_i !== undefined) document.getElementById('d-sp-i').value = data.d.sp_i;
                if(data.d.sp_m !== undefined) document.getElementById('d-sp-m').value = data.d.sp_m;
                
                if(data.d.al_r !== undefined) document.getElementById('d-al-r').value = data.d.al_r;
                if(data.d.al_i !== undefined) document.getElementById('d-al-i').value = data.d.al_i;
                if(data.d.al_m !== undefined) document.getElementById('d-al-m').value = data.d.al_m;

                if(data.d.yr !== undefined) {
                    document.getElementById('d-yr').value = data.d.yr;
                    document.getElementById('d-yr-r').value = data.d.yr;
                    sI('d-yr');
                }
                if(data.d.wd !== undefined) {
                    document.getElementById('d-wd').value = data.d.wd;
                    document.getElementById('d-wd-r').value = data.d.wd;
                    sI('d-wd');
                }
                if(data.d.nisa !== undefined) {
                    nD = data.d.nisa;
                    document.getElementById('d-nisa').classList.toggle('on', nD);
                }
            }

            // Tab
            if(data.tab) {
                const tabBtn = document.querySelector(`.tab-btn[data-tab="${data.tab}"]`);
                if(tabBtn) tabBtn.click();
            }

            // åˆæœŸè¡¨ç¤ºç”¨ã®ã‚¯ãƒ©ã‚¹èª¿æ•´
            onIn('s-init', 's-init-w');
            
        } catch(e) {
            console.error('Failed to parse saved data', e);
        }
    }
}

function saveData() {
    const data = {
        s: {
            prod: cProd,
            rate: document.getElementById('s-rate').value,
            init: document.getElementById('s-init').value,
            mo: document.getElementById('s-mo').value,
            yr: document.getElementById('s-yr').value,
            wd: document.getElementById('s-wd').value,
            nisa: nS
        },
        d: {
            sp_r: document.getElementById('d-sp-r').value,
            sp_i: document.getElementById('d-sp-i').value,
            sp_m: document.getElementById('d-sp-m').value,
            al_r: document.getElementById('d-al-r').value,
            al_i: document.getElementById('d-al-i').value,
            al_m: document.getElementById('d-al-m').value,
            yr: document.getElementById('d-yr').value,
            wd: document.getElementById('d-wd').value,
            nisa: nD
        },
        tab: document.querySelector('.tab-btn.active').dataset.tab
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function saveTab(tabName) {
    saveData();
}

function saveAndCalc() {
    calc();
    saveData();
}

function saveAndCD() {
    cD();
    saveData();
}
// ====================================

window.addEventListener('DOMContentLoaded',()=>{
    setIcon();
    initTabs();
    loadData(); // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
    calc();
    cD();
});

function setIcon(){const c=document.createElement('canvas');c.width=512;c.height=512;const x=c.getContext('2d');const g=x.createLinearGradient(0,0,512,512);g.addColorStop(0,'#15803d');g.addColorStop(1,'#0d9488');x.fillStyle=g;x.fillRect(0,0,512,512);x.beginPath();x.moveTo(80,360);x.lineTo(190,260);x.lineTo(300,310);x.lineTo(420,140);x.lineWidth=36;x.strokeStyle='white';x.lineCap='round';x.lineJoin='round';x.stroke();x.beginPath();x.arc(420,140,30,0,Math.PI*2);x.fillStyle='#fcd34d';x.fill();const u=c.toDataURL('image/png');['dynamic-favicon','dynamic-apple-icon'].forEach(id=>{const e=document.getElementById(id);if(e)e.href=u;});}

function initTabs(){document.querySelectorAll('.tab-btn').forEach(b=>{b.addEventListener('click',()=>{document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));b.classList.add('active');document.getElementById('tab-'+b.dataset.tab).classList.add('active');if(b.dataset.tab==='single'&&sC)sC.resize();if(b.dataset.tab==='dual'){if(dC)dC.resize();cD();}if(b.dataset.tab==='hierarchy')uH();});});}

function fm(n){const a=Math.abs(n),s=n<0?'-':'';if(a<10000)return s+Math.round(a).toLocaleString()+'å††';const o=Math.floor(a/1e8),m=Math.floor((a%1e8)/1e4);if(o>0)return`${s}${o}å„„${m>0?m.toLocaleString()+'ä¸‡':''}å††`;return`${s}${m.toLocaleString()}ä¸‡å††`;}
function fman(n){const a=Math.abs(n),s=n<0?'-':'';const o=Math.floor(a/1e8),m=Math.floor((a%1e8)/1e4);if(o>0)return`${s}${o}å„„${m>0?m.toLocaleString()+'ä¸‡':''}`;return`${s}${m.toLocaleString()}ä¸‡`;}

const UN={'s-mo':'ä¸‡å††','s-yr':'å¹´','s-wd':'%','d-yr':'å¹´','d-wd':'%'};
function sR(p){const r=document.getElementById(p+'-r'),i=document.getElementById(p),l=document.getElementById(p+'-v');i.value=r.value;if(l)l.textContent=r.value+(UN[p]||'');if(p.startsWith('s-'))saveAndCalc();else saveAndCD();}
function sI(p){const i=document.getElementById(p),r=document.getElementById(p+'-r'),l=document.getElementById(p+'-v');if(r)r.value=i.value;if(l)l.textContent=i.value+(UN[p]||'');}
function onIn(id,wid){const v=document.getElementById(id).value,w=document.getElementById(wid);parseFloat(v)>0?w.classList.remove('hl'):w.classList.add('hl');}

function selProd(k){cProd=k;document.getElementById('btn-s-sp').className=k==='sp500'?'product-btn sel':'product-btn';document.getElementById('btn-s-al').className=k==='all'?'product-btn sel':'product-btn';document.getElementById('s-rate').value=P[k].rate;document.getElementById('s-rate-src').textContent=P[k].src;saveAndCalc();}
function resetRate(){document.getElementById('s-rate').value=P[cProd].rate;saveAndCalc();}
function rDR(t){if(t==='sp500')document.getElementById('d-sp-r').value=P.sp500.rate;else document.getElementById('d-al-r').value=P.all.rate;saveAndCD();}

function tgN(p){if(p==='s'){nS=!nS;document.getElementById('s-nisa').classList.toggle('on',nS);saveAndCalc();}else{nD=!nD;document.getElementById('d-nisa').classList.toggle('on',nD);saveAndCD();}}
function tgD(p){document.getElementById(p+'-dtb').classList.toggle('open');document.getElementById(p+'-dtw').classList.toggle('show');}

function calc(){
    const init=(parseFloat(document.getElementById('s-init').value)||0)*1e4;
    const mo=(parseFloat(document.getElementById('s-mo').value)||0)*1e4;
    const yr=parseInt(document.getElementById('s-yr').value)||20;
    const rY=parseFloat(document.getElementById('s-rate').value)||0;
    const wd=parseFloat(document.getElementById('s-wd').value)||0;
    const r=rY/100/12;
    let c=init;const lb=['é–‹å§‹'],dA=[Math.round(c)],dB=[Math.round(init)];const rows=[];
    for(let y=1;y<=yr;y++){for(let m=0;m<12;m++)c=(c+mo)*(1+r);let wA=0;if(wd>0){wA=c*(wd/100);c-=wA;}const b=init+mo*12*y;lb.push(y+'å¹´');dA.push(Math.round(c));dB.push(Math.round(b));rows.push({y,b,a:c,p:c-b,w:wA});}
    const tI=init+mo*12*yr;let pr=c-tI,tx=0,fd=c;
    if(!nS&&pr>0){tx=pr*TAX;fd=c-tx;pr-=tx;}
    LR={initial:init,final:c,profit:pr,inputs:{rate:rY,monthly:mo,years:yr,initial:init}};
    document.getElementById('s-final').textContent=fm(fd);
    document.getElementById('s-inv').textContent=fm(tI);
    const pe=document.getElementById('s-profit');if(pr<0){pe.textContent=fm(pr);pe.className='rp neg';}else{pe.textContent='+'+fm(pr);pe.className='rp pos';}
    if(nS){document.getElementById('s-nb-l').textContent='ğŸ›ï¸ NISAéèª²ç¨';document.getElementById('s-tax').textContent='ç¯€ç¨é¡: '+fm(Math.max(0,(c-tI))*TAX);}else{document.getElementById('s-nb-l').textContent='ğŸ’° èª²ç¨å£åº§ï¼ˆç¨å¼•å¾Œï¼‰';document.getElementById('s-tax').textContent='ç¨é¡: '+fm(tx);}
    document.getElementById('s-dtbody').innerHTML=rows.map(r=>`<tr><td>${r.y}å¹´</td><td>${fman(r.b)}å††</td><td>${fman(r.a)}å††</td><td style="color:${r.p>=0?'var(--g600)':'var(--r500)'}">${r.p>=0?'+':''}${fman(r.p)}å††</td><td>${r.w>0?fman(r.w)+'å††':'-'}</td></tr>`).join('');
    drawC('s-chart',lb,dA,dB);
}

function cD(){
    const si=(parseFloat(document.getElementById('d-sp-i').value)||0)*1e4,sm=(parseFloat(document.getElementById('d-sp-m').value)||0)*1e4,sr=(parseFloat(document.getElementById('d-sp-r').value)||0)/100/12;
    const ai=(parseFloat(document.getElementById('d-al-i').value)||0)*1e4,am=(parseFloat(document.getElementById('d-al-m').value)||0)*1e4,ar=(parseFloat(document.getElementById('d-al-r').value)||0)/100/12;
    const yr=parseInt(document.getElementById('d-yr').value)||20,wd=parseFloat(document.getElementById('d-wd').value)||0;
    let sp=si,al=ai;const lb=['é–‹å§‹'],dT=[Math.round(sp+al)],dS=[Math.round(sp)],dAl=[Math.round(al)],dB=[Math.round(si+ai)];const rows=[];
    for(let y=1;y<=yr;y++){for(let m=0;m<12;m++){sp=(sp+sm)*(1+sr);al=(al+am)*(1+ar);}if(wd>0){const f=1-wd/100;sp*=f;al*=f;}const b=(si+ai)+(sm+am)*12*y;lb.push(y+'å¹´');dT.push(Math.round(sp+al));dS.push(Math.round(sp));dAl.push(Math.round(al));dB.push(Math.round(b));rows.push({y,b,sp,al,t:sp+al});}
    const tF=sp+al,tI=(si+ai)+(sm+am)*12*yr;let pr=tF-tI,tx=0,fd=tF;
    if(!nD&&pr>0){tx=pr*TAX;fd=tF-tx;pr-=tx;}
    const tm=sm+am;const wR=tm>0?((parseFloat(document.getElementById('d-sp-r').value)*sm)+(parseFloat(document.getElementById('d-al-r').value)*am))/tm:parseFloat(document.getElementById('d-sp-r').value);
    LR={initial:si+ai,final:tF,profit:pr,inputs:{rate:wR,monthly:tm,years:yr,initial:si+ai}};
    document.getElementById('d-final').textContent=fm(fd);document.getElementById('d-inv').textContent=fm(tI);
    const pe=document.getElementById('d-profit');if(pr<0){pe.textContent=fm(pr);pe.className='rp neg';}else{pe.textContent='+'+fm(pr);pe.className='rp pos';}
    if(nD){document.getElementById('d-nb-l').textContent='ğŸ›ï¸ NISAéèª²ç¨';document.getElementById('d-tax').textContent='ç¯€ç¨é¡: '+fm(Math.max(0,(tF-tI))*TAX);}else{document.getElementById('d-nb-l').textContent='ğŸ’° èª²ç¨å£åº§ï¼ˆç¨å¼•å¾Œï¼‰';document.getElementById('d-tax').textContent='ç¨é¡: '+fm(tx);}
    document.getElementById('d-dtbody').innerHTML=rows.map(r=>`<tr><td>${r.y}å¹´</td><td>${fman(r.b)}å††</td><td>${fman(r.sp)}å††</td><td>${fman(r.al)}å††</td><td style="font-weight:700">${fman(r.t)}å††</td></tr>`).join('');
    drawDC('d-chart',lb,dT,dS,dAl,dB);
}

function cOpts(){return{responsive:true,maintainAspectRatio:false,interaction:{intersect:false,mode:'index'},plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(15,23,42,.92)',titleFont:{size:11,weight:'bold'},bodyFont:{size:11},cornerRadius:8,padding:10,callbacks:{label:c=>c.dataset.label+': '+fm(c.raw)}}},scales:{x:{display:true,grid:{display:false},ticks:{font:{size:9},color:'#94a3b8',maxTicksLimit:10}},y:{display:true,grid:{color:'rgba(0,0,0,.03)'},ticks:{font:{size:9},color:'#94a3b8',callback:v=>{if(v>=1e8)return(v/1e8).toFixed(1)+'å„„';if(v>=1e4)return(v/1e4).toLocaleString()+'ä¸‡';return v;}}}}};}

function drawC(id,lb,dA,dB){const ctx=document.getElementById(id).getContext('2d');if(sC)sC.destroy();sC=new Chart(ctx,{type:'line',data:{labels:lb,datasets:[{label:'è³‡ç”£æ®‹é«˜',data:dA,borderColor:'#22c55e',backgroundColor:'rgba(34,197,94,.08)',fill:true,tension:.35,pointRadius:1.5,pointHoverRadius:5,borderWidth:2.5,order:1},{label:'æŠ•è³‡å…ƒæœ¬',data:dB,borderColor:'#cbd5e1',backgroundColor:'rgba(203,213,225,.12)',fill:true,tension:0,pointRadius:0,borderWidth:1.5,borderDash:[4,4],order:2}]},options:cOpts()});}

function drawDC(id,lb,dT,dS,dAl,dB){const ctx=document.getElementById(id).getContext('2d');if(dC)dC.destroy();dC=new Chart(ctx,{type:'line',data:{labels:lb,datasets:[{label:'åˆè¨ˆè³‡ç”£',data:dT,borderColor:'#22c55e',backgroundColor:'rgba(34,197,94,.06)',fill:true,tension:.35,pointRadius:1.5,pointHoverRadius:5,borderWidth:2.5,order:1},{label:'S&P500',data:dS,borderColor:'#3b82f6',backgroundColor:'transparent',fill:false,tension:.35,pointRadius:0,borderWidth:1.5,borderDash:[6,3],order:2},{label:'å…¨ä¸–ç•Œæ ªå¼',data:dAl,borderColor:'#14b8a6',backgroundColor:'transparent',fill:false,tension:.35,pointRadius:0,borderWidth:1.5,borderDash:[6,3],order:3},{label:'æŠ•è³‡å…ƒæœ¬',data:dB,borderColor:'#cbd5e1',backgroundColor:'rgba(203,213,225,.1)',fill:true,tension:0,pointRadius:0,borderWidth:1.5,borderDash:[4,4],order:4}]},options:cOpts()});}

function uH(){
    const fM=LR.final/1e4,iM=LR.initial/1e4;
    const ci=T.findIndex(t=>iM>=t.min),ct=T[ci!==-1?ci:4];
    const fi=T.findIndex(t=>fM>=t.min),ft=T[fi!==-1?fi:4];
    document.getElementById('h-now').textContent=ct.name+` (${fm(LR.initial)})`;
    document.getElementById('h-fut').textContent=ft.name+` (${fm(LR.final)})`;
    document.getElementById('a-now').setAttribute('transform',`translate(0,${ct.y})`);
    document.getElementById('a-fut').setAttribute('transform',`translate(0,${ft.y})`);
    T.forEach(t=>{const e=document.getElementById(t.id);if(e)e.setAttribute('opacity','.35');});
    const fe=document.getElementById(ft.id);if(fe)fe.setAttribute('opacity','.85');
    const tt=fi>0?T[fi-1]:T[0],ta=tt.min*1e4;
    if(fM>=50000&&fi===0){
        document.getElementById('h-gap').textContent='æœ€é«˜ãƒ©ãƒ³ã‚¯åˆ°é”ï¼ğŸ‰';document.getElementById('h-prog').style.width='100%';document.getElementById('h-tgt').textContent='Goal!';
        document.getElementById('adv-t').innerHTML='<div class="abl">ğŸŠ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</div><div class="abv">æœ€é«˜ãƒ©ãƒ³ã‚¯ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚</div>';
        document.getElementById('adv-m').innerHTML='<div class="abl">ğŸ›¡ï¸ ç¶­æŒãƒ»ç¶™æ‰¿</div><div class="abv">ãƒªã‚¹ã‚¯ç®¡ç†ã¨åˆ†æ•£ã‚’å¾¹åº•ã—ã¾ã—ã‚‡ã†ã€‚</div>';
    }else{
        const gap=ta-LR.final,prog=Math.min(100,(LR.final/ta)*100);
        document.getElementById('h-gap').textContent='ã‚ã¨ '+fm(gap);document.getElementById('h-prog').style.width=prog+'%';document.getElementById('h-tgt').textContent='ç›®æ¨™: '+tt.name+' ('+tt.min.toLocaleString()+'ä¸‡å††)';
        const r=LR.inputs.rate/100/12,mo=LR.inputs.monthly;let tmp=LR.initial,reached=false,ytg=0;
        for(let i=1;i<=1200;i++){tmp=(tmp+mo)*(1+r);if(tmp>=ta){ytg=(i/12).toFixed(1);reached=true;break;}}
        document.getElementById('adv-t').innerHTML=reached
            ?`<div class="abl">â±ï¸ ä»Šã®ç©ç«‹ãƒšãƒ¼ã‚¹ãªã‚‰...</div><div class="abv">ç´„ <span class="ahl">${ytg}å¹´å¾Œ</span> ã«åˆ°é”ï¼</div>`
            :`<div class="abl">â±ï¸ ä»Šã®ãƒšãƒ¼ã‚¹ã ã¨...</div><div class="abv">100å¹´ä»¥ä¸Šã‹ã‹ã‚Šã¾ã™ã€‚ç©ç«‹é¡ã‚’å¢—ã‚„ã™ã‹åˆæœŸæŠ•è³‡ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚</div>`;
        const n=LR.inputs.years*12,cf=Math.pow(1+r,n),ig=LR.initial*cf;let rm=0;if(ta>ig)rm=((ta-ig)*r)/(cf-1);const ad=Math.max(0,rm-mo),adM=(ad/1e4).toFixed(1);
        document.getElementById('adv-m').innerHTML=`<div class="abl">ğŸ’° ${LR.inputs.years}å¹´ã§å±Šãã«ã¯...</div><div class="abv">æ¯æœˆã®ç©ç«‹ã‚’ã‚ã¨<br><span class="ahl">+${adM}ä¸‡å††</span> å¢—ã‚„ãã†ï¼</div>`;
    }
}
</script>
</body>
</html>
