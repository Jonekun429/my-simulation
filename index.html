<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆã¨åŸºæœ¬è¨­å®š */
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f1f5f9; /* slate-100 */
            color: #334155; /* slate-700 */
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            margin: 8px 0;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #10b981; /* emerald-500 */
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: -8px;
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:active {
            transform: scale(1.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0; /* slate-200 */
            border-radius: 2px;
        }
        
        /* å…¥åŠ›æ¬„ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        .input-group:focus-within {
            border-color: #10b981; /* emerald-500 */
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ */
        input::placeholder {
            color: #94a3b8;
        }

        /* æœªå…¥åŠ›ï¼ˆæ¨å¥¨ï¼‰çŠ¶æ…‹ã®èƒŒæ™¯è‰²ã‚¯ãƒ©ã‚¹ */
        .bg-required {
            background-color: #fef9c3; /* yellow-100: è–„ã„é»„è‰²ã§æ³¨æ„å–šèµ· */
            border-color: #fde047; /* yellow-300 */
        }
        /* å…¥åŠ›å®Œäº†ï¼ˆã‚¯ãƒªã‚¢ï¼‰çŠ¶æ…‹ã®èƒŒæ™¯è‰²ã‚¯ãƒ©ã‚¹ */
        .bg-cleared {
            background-color: #ffffff;
            border-color: #e2e8f0;
        }

        /* ã‚¿ãƒ–ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-btn.active {
            background-color: #ffffff;
            color: #10b981; /* emerald-500 */
            border-bottom: 3px solid #10b981;
            font-weight: bold;
        }
        .tab-btn {
            color: #64748b; /* slate-500 */
            border-bottom: 3px solid transparent;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 md:px-8 pt-4 pb-0">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800 flex items-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
            </h1>
            
            <div class="flex space-x-6">
                <button onclick="switchTab('simulator')" id="tab-btn-simulator" class="tab-btn active pb-3 px-2 transition-colors">
                    ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
                </button>
                <button onclick="switchTab('guide')" id="tab-btn-guide" class="tab-btn pb-3 px-2 transition-colors">
                    ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰
                </button>
            </div>
        </div>
    </div>

    <div class="flex-grow p-4 md:p-8 max-w-6xl mx-auto w-full">

        <div id="tab-content-simulator" class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-start fade-in">
            
            <div class="lg:col-span-5 space-y-4">
                
                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100">
                    <h2 class="text-lg font-bold text-slate-700 mb-3">1. é‹ç”¨å•†å“ã‚’é¸ã¶</h2>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button onclick="selectProduct('sp500')" id="btn-sp500" class="p-3 rounded-xl border transition-all duration-200 text-center relative font-bold">
                            S&P500 (ç±³å›½æ ª)
                        </button>
                        <button onclick="selectProduct('all')" id="btn-all" class="p-3 rounded-xl border transition-all duration-200 text-center relative font-bold">
                            å…¨ä¸–ç•Œæ ªå¼
                        </button>
                    </div>
                    <div class="bg-slate-50 rounded-xl p-3 border border-slate-200">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-slate-500">éå»11å¹´ã®å¹³å‡åˆ©å›ã‚Š</span>
                            <a href="#" id="source-link" target="_blank" class="text-xs text-emerald-500 hover:underline flex items-center">
                                ãƒ‡ãƒ¼ã‚¿å‚ç…§å…ƒ (æ¥½å¤©è¨¼åˆ¸)
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                </svg>
                            </a>
                        </div>
                        <div class="flex items-end text-emerald-600">
                            <span class="text-2xl font-bold" id="display-average-rate">--.--</span>
                            <span class="text-base font-bold mb-0.5 ml-0.5">%</span>
                        </div>
                    </div>
                </section>

                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 space-y-5">
                    <h2 class="text-lg font-bold text-slate-700">2. é‡‘é¡ã‚’å…¥ã‚Œã‚‹</h2>

                    <div class="hidden">
                        <input type="number" id="annualRate" value="13.25">
                    </div>

                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 block">
                            åˆæœŸæŠ•è³‡é¡ (å…ƒæ‰‹) <span class="text-xs text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded ml-2">å…¥åŠ›æ¨å¥¨</span>
                        </label>
                        <div id="initialAmountGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 transition-colors bg-required">
                            <input type="number" id="initialAmount" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right placeholder-slate-400" placeholder="0" oninput="checkInput('initialAmount'); calculate();" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">ä¸‡å††</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between">
                            <span>æ¯æœˆã®ç©ç«‹é¡ <span class="text-xs text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded ml-2">å…¥åŠ›æ¨å¥¨</span></span>
                            <span class="text-emerald-500" id="monthlyAmountLabel">ãªã—</span>
                        </label>
                        <input type="range" id="monthlyAmountSlider" min="0" max="30" value="3" step="1" oninput="syncInputs('monthlyAmountSlider', 'monthlyAmount')">
                        <div id="monthlyAmountGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 mt-1 transition-colors bg-required">
                            <input type="number" id="monthlyAmount" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right placeholder-slate-400" placeholder="ä¾‹: 3" value="3" oninput="checkInput('monthlyAmount'); syncInputs('monthlyAmount', 'monthlyAmountSlider');" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">ä¸‡å††</span>
                        </div>
                    </div>

                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between">
                            <span>é‹ç”¨æœŸé–“ <span class="text-xs text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded ml-2">å…¥åŠ›æ¨å¥¨</span></span>
                        </label>
                        <input type="range" id="yearsSlider" min="1" max="50" value="20" oninput="syncInputs('yearsSlider', 'years')">
                        <div id="yearsGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 mt-1 transition-colors bg-required">
                            <input type="number" id="years" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right placeholder-slate-400" value="20" oninput="checkInput('years'); syncInputs('years', 'yearsSlider');" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">å¹´</span>
                        </div>
                    </div>
                </section>

                <section class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100">
                    <h2 class="text-lg font-bold text-slate-700 mb-1">3. å–ã‚Šå´©ã—è¨­å®š <span class="text-xs font-normal text-slate-400 ml-2">(ä»»æ„)</span></h2>
                    <p class="text-xs text-slate-500 mb-3">è²¯ã‚ãŸè³‡ç”£ã‚’ã€Œä½¿ã„ãªãŒã‚‰é‹ç”¨ã€ã—ãŸã„æ™‚ã ã‘è¨­å®šã—ã¾ã™ã€‚</p>
                    
                    <div>
                        <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between">
                            <span>æ¯å¹´1æœˆ1æ—¥ã®å–ã‚Šå´©ã—ç‡</span>
                            <span class="text-emerald-600 font-bold" id="withdrawalLabel">ãªã—</span>
                        </label>
                        <input type="range" id="withdrawalRateSlider" min="0" max="15" value="0" step="0.1" oninput="syncInputs('withdrawalRateSlider', 'withdrawalRate')">
                        
                        <div class="flex items-center bg-white border-2 border-slate-200 rounded-xl px-3 py-2 mt-1 focus-within:border-emerald-500 transition-colors">
                            <input type="number" id="withdrawalRate" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="0" step="0.1" oninput="syncInputs('withdrawalRate', 'withdrawalRateSlider')" onfocus="this.select()">
                            <span class="text-slate-500 font-bold ml-2">%</span>
                        </div>
                    </div>
                </section>
            </div>

            <div class="lg:col-span-7 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl p-5 text-white shadow-md md:col-span-2">
                        <p class="text-emerald-50 text-sm font-bold mb-1">æœ€çµ‚è³‡ç”£æ®‹é«˜</p>
                        <div class="text-4xl md:text-5xl font-bold tracking-tight" id="displayFinalAsset">0å††</div>
                        <div class="mt-3 flex justify-between items-end border-t border-white/20 pt-3">
                            <div>
                                <p class="text-emerald-50 text-xs">é‹ç”¨åç›Š</p>
                                <p class="text-lg font-bold text-green-200" id="displayTotalProfit">+0å††</p>
                            </div>
                            <div class="text-right">
                                <p class="text-emerald-50 text-xs">ç´¯è¨ˆå—å–é¡</p>
                                <p class="text-lg font-bold text-orange-200" id="displayTotalWithdrawn">0å††</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl p-4 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 flex flex-col justify-center">
                        <p class="text-slate-500 text-xs font-bold mb-1">ç´¯è¨ˆæŠ•è³‡é¡ (å…ƒæœ¬)</p>
                        <p class="text-xl font-bold text-slate-700" id="displayTotalInvestment">0å††</p>
                    </div>
                    <div class="bg-white rounded-2xl p-4 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 flex flex-col justify-center">
                        <p class="text-slate-500 text-xs font-bold mb-1">é©ç”¨ä¸­ã®å•†å“</p>
                        <p class="text-xl font-bold text-emerald-600" id="displayProductName">S&P500</p>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-5 shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100">
                    <h3 class="text-lg font-bold text-slate-700 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-500 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                        è³‡ç”£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¨ç§»
                    </h3>
                    <div class="relative h-72 w-full">
                        <canvas id="simulationChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-[0_2px_8px_rgba(0,0,0,0.04)] border border-slate-100 overflow-hidden">
                    <button onclick="toggleTable()" class="w-full p-4 flex justify-between items-center text-slate-700 font-bold hover:bg-slate-50 transition bg-white">
                        <span class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            å¹´æ¬¡è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹
                        </span>
                        <svg id="tableArrow" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="tableContent" class="hidden border-t border-slate-100 bg-slate-50">
                        <div class="p-2">
                            <table class="w-full text-sm text-left whitespace-nowrap">
                                <thead class="text-slate-500 bg-slate-100">
                                    <tr>
                                        <th class="px-4 py-2 font-semibold rounded-l-lg">å¹´æ•°</th>
                                        <th class="px-4 py-2 text-right font-semibold" id="col2Header">ç©ç«‹/å—å–</th>
                                        <th class="px-4 py-2 text-right font-semibold rounded-r-lg">è³‡ç”£æ®‹é«˜</th>
                                    </tr>
                                </thead>
                                <tbody id="resultTableBody" class="divide-y divide-slate-200 bg-white"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="tab-content-guide" class="hidden max-w-3xl mx-auto fade-in pb-10">
            <div class="bg-white rounded-3xl p-6 md:p-10 shadow-sm border border-slate-100 space-y-10">
                
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">ğŸ”° ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>
                    <p class="text-slate-500">3ã‚¹ãƒ†ãƒƒãƒ—ã§å°†æ¥ã®ãŠé‡‘ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼</p>
                </div>

                <div class="space-y-8">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-emerald-100 text-emerald-600 w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl mr-4">1</div>
                        <div>
                            <h3 class="text-lg font-bold text-slate-800 mb-2">å•†å“ã‚’é¸ã¶</h3>
                            <p class="text-slate-600 leading-relaxed">
                                ã¾ãšã¯æŠ•è³‡å…ˆã‚’é¸ã³ã¾ã™ã€‚
                                <br><span class="font-bold text-slate-800">ğŸ‡ºğŸ‡¸ S&P500</span> ã¯ã‚¢ãƒ¡ãƒªã‚«ã®å¼·ã„ä¼æ¥­500ç¤¾ã«ã€
                                <br><span class="font-bold text-slate-800">ğŸŒ å…¨ä¸–ç•Œæ ªå¼</span> ã¯ä¸–ç•Œä¸­ã®ä¼æ¥­ã«åˆ†æ•£ã—ã¦æŠ•è³‡ã—ã¾ã™ã€‚
                                <br>ã©ã¡ã‚‰ã‚‚éå»ã®å®Ÿç¸¾ï¼ˆå¹³å‡åˆ©å›ã‚Šï¼‰ãŒè‡ªå‹•ã§ã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-emerald-100 text-emerald-600 w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl mr-4">2</div>
                        <div>
                            <h3 class="text-lg font-bold text-slate-800 mb-2">é‡‘é¡ã‚’å…¥ã‚Œã‚‹ï¼ˆé‡è¦ï¼ï¼‰</h3>
                            <p class="text-slate-600 leading-relaxed mb-3">
                                <span class="bg-yellow-100 px-1 rounded">é»„è‰²ã„æ </span> ã®ã¨ã“ã‚ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
                            </p>
                            <ul class="list-disc list-inside text-slate-600 space-y-1 ml-2">
                                <li><span class="font-bold">åˆæœŸæŠ•è³‡é¡</span>ï¼šã„ã¾æ‰‹å…ƒã«ã‚ã£ã¦ã€æœ€åˆã«æŠ•è³‡ã™ã‚‹ãŠé‡‘ï¼ˆ0å††ã§ã‚‚OKï¼‰ã€‚</li>
                                <li><span class="font-bold">æ¯æœˆã®ç©ç«‹é¡</span>ï¼šæ¯æœˆã®ãŠçµ¦æ–™ã‚„ãƒã‚¤ãƒˆä»£ã‹ã‚‰ã‚³ãƒ„ã‚³ãƒ„è¶³ã™ãŠé‡‘ã€‚</li>
                                <li><span class="font-bold">é‹ç”¨æœŸé–“</span>ï¼šä½•å¹´ç¶šã‘ã‚‹ã‹ã€‚é•·ã„ã»ã©ãŠé‡‘ã¯å¢—ãˆã‚„ã™ããªã‚Šã¾ã™ï¼ˆè¤‡åˆ©åŠ¹æœï¼‰ã€‚</li>
                            </ul>
                            <p class="text-xs text-slate-400 mt-2">â€»å…¥åŠ›ã™ã‚‹ã¨æ ã®è‰²ãŒç™½ï¼ˆã‚¯ãƒªã‚¢ï¼‰ã«æˆ»ã‚Šã¾ã™ã€‚</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex-shrink-0 bg-emerald-100 text-emerald-600 w-12 h-12 rounded-full flex items-center justify-center font-bold text-xl mr-4">3</div>
                        <div>
                            <h3 class="text-lg font-bold text-slate-800 mb-2">ã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹</h3>
                            <p class="text-slate-600 leading-relaxed">
                                å³å´ã®ã‚°ãƒ©ãƒ•ãŒå°†æ¥ã®äºˆæƒ³å›³ã§ã™ã€‚
                                <br><span class="text-emerald-500 font-bold">ç·‘ã®ç·š</span>ãŒå³è‚©ä¸ŠãŒã‚Šãªã‚‰è³‡ç”£ãŒå¢—ãˆã¦ã„ã¾ã™ã€‚
                                <br>ã€Œã‚‚ã—æ¯æœˆ3ä¸‡å††ã‚’20å¹´ç¶šã‘ãŸã‚‰...ï¼Ÿã€ãªã©ã€è‰²ã€…ãªæ•°å­—ã‚’å…¥ã‚Œã¦è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
                            </p>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-50 p-6 rounded-2xl">
                    <h4 class="font-bold text-slate-700 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        çŸ¥ã£ã¦ãŠãã¨ä¾¿åˆ©ãªã“ã¨
                    </h4>
                    <dl class="space-y-3 text-sm">
                        <div>
                            <dt class="font-bold text-slate-800">å–ã‚Šå´©ã—è¨­å®šã£ã¦ï¼Ÿ</dt>
                            <dd class="text-slate-600">ã€Œè€å¾Œã«å¹´é‡‘ä»£ã‚ã‚Šã«å°‘ã—ãšã¤ä½¿ã„ãŸã„ã€ã¨ãã«ä½¿ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€Œ4%ã€ã«ã™ã‚‹ã¨ã€å¢—ãˆãŸè³‡ç”£ã®ä¸­ã‹ã‚‰æ¯å¹´4%ãšã¤ç¾é‡‘ã¨ã—ã¦å—ã‘å–ã‚Œã¾ã™ã€‚</dd>
                        </div>
                        <div>
                            <dt class="font-bold text-slate-800">è¤‡åˆ©ï¼ˆãµãã‚Šï¼‰ã£ã¦ï¼Ÿ</dt>
                            <dd class="text-slate-600">å¢—ãˆãŸåˆ©ç›ŠãŒã•ã‚‰ã«åˆ©ç›Šã‚’ç”Ÿã‚€ã“ã¨ã€‚ã€Œé›ªã ã‚‹ã¾å¼ã€ã«ãŠé‡‘ãŒå¢—ãˆã‚‹ä»•çµ„ã¿ã§ã™ã€‚æ™‚é–“ãŒé•·ã„ã»ã©åŠ¹æœå¤§ï¼</dd>
                        </div>
                    </dl>
                </div>

                <div class="text-center pt-4">
                    <button onclick="switchTab('simulator')" class="bg-emerald-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-emerald-600 transition transform hover:scale-105">
                        ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã«æˆ»ã‚‹
                    </button>
                </div>

            </div>
        </div>
        </div>

    <script>
        // --- è¨­å®šãƒ‡ãƒ¼ã‚¿ ---
        const PRODUCTS = {
            sp500: { 
                name: 'S&P500 (ç±³å›½æ ª)', 
                rate: 13.25, 
                url: 'https://www.rakuten-sec.co.jp/web/fund/detail/?ID=JP90C000GKC6' 
            },
            all:   { 
                name: 'å…¨ä¸–ç•Œæ ªå¼ (ã‚ªãƒ«ã‚«ãƒ³)', 
                rate: 9.99,  
                url: 'https://www.rakuten-sec.co.jp/web/fund/detail/?ID=JP90C000H1T1' 
            }
        };
        
        let currentProduct = 'sp500';
        let myChart = null;

        // --- åˆæœŸåŒ– ---
        window.onload = function() {
            selectProduct('sp500');
            // åˆæœŸçŠ¶æ…‹ã®è‰²ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
            checkInput('initialAmount');
            checkInput('monthlyAmount');
            checkInput('years');
            
            // è¨ˆç®—å®Ÿè¡Œ
            calculate();
        };

        // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
        function switchTab(tabName) {
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('tab-btn-simulator').classList.remove('active');
            document.getElementById('tab-btn-guide').classList.remove('active');
            document.getElementById('tab-btn-' + tabName).classList.add('active');

            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('tab-content-simulator').classList.add('hidden');
            document.getElementById('tab-content-guide').classList.add('hidden');
            document.getElementById('tab-content-' + tabName).classList.remove('hidden');
            
            // ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆã‚¹ãƒãƒ›å¯¾ç­–ï¼‰
            window.scrollTo(0, 0);
        }

        // --- å…¥åŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆè‰²å¤‰ãˆï¼‰ ---
        function checkInput(id) {
            const input = document.getElementById(id);
            const group = document.getElementById(id + 'Group');
            
            // å€¤ãŒç©ºã€ã¾ãŸã¯0ä»¥ä¸‹ãªã‚‰ã€Œå¿…é ˆï¼ˆé»„è‰²ï¼‰ã€ã€ãã‚Œä»¥å¤–ãªã‚‰ã€Œã‚¯ãƒªã‚¢ï¼ˆç™½ï¼‰ã€
            // â€»ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤ºçŠ¶æ…‹ã‚‚ã€Œç©ºã€ã¨ã¿ãªã™
            if (input.value === '' || parseFloat(input.value) <= 0) {
                // åˆæœŸå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ(ç©ç«‹3ä¸‡ãªã©)ã¯ã‚¯ãƒªã‚¢æ‰±ã„ã«ã™ã‚‹ã‹ã€
                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ãˆã¦å…¥åŠ›ã‚’ä¿ƒã™ãŸã‚ã«é»„è‰²ã«ã™ã‚‹ã‹ã€‚
                // ã“ã“ã§ã¯ã€Œ0ã€ã¾ãŸã¯ã€Œç©ºã€ã®æ™‚ã ã‘é»„è‰²ã«ã™ã‚‹ã€‚
                // ç©ç«‹é¡ã®åˆæœŸå€¤ã¯3ãªã®ã§ã€æœ€åˆã‹ã‚‰ç™½ã«ãªã‚‹ã€‚
                if(input.value == 0 || input.value == '') {
                     group.classList.add('bg-required');
                     group.classList.remove('bg-cleared');
                } else {
                     group.classList.remove('bg-required');
                     group.classList.add('bg-cleared');
                }
            } else {
                group.classList.remove('bg-required');
                group.classList.add('bg-cleared');
            }
        }

        // --- UIæ“ä½œ ---
        function selectProduct(key) {
            currentProduct = key;
            const p = PRODUCTS[key];
            
            ['sp500', 'all'].forEach(k => {
                const btn = document.getElementById('btn-' + k);
                if(k === key) {
                    btn.className = "p-3 rounded-xl border-2 border-emerald-500 bg-emerald-50 text-emerald-700 shadow-sm font-bold relative";
                    if(!btn.innerHTML.includes('svg')) {
                         btn.innerHTML += '<span class="absolute top-1 right-1 text-emerald-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg></span>';
                    }
                } else {
                    btn.className = "p-3 rounded-xl border border-slate-200 bg-white text-slate-500 hover:border-emerald-300 hover:bg-slate-50 transition-all font-medium";
                    const svg = btn.querySelector('span');
                    if(svg) svg.remove();
                }
            });

            document.getElementById('display-average-rate').innerText = p.rate.toFixed(2);
            document.getElementById('source-link').href = p.url;
            document.getElementById('displayProductName').innerText = p.name;
            document.getElementById('annualRate').value = p.rate;
            calculate();
        }

        function syncInputs(fromId, toId) {
            const val = document.getElementById(fromId).value;
            document.getElementById(toId).value = val;
            
            // è‰²ãƒã‚§ãƒƒã‚¯ã‚‚é€£å‹•
            if(toId === 'monthlyAmount' || toId === 'years') {
                checkInput(toId);
            }

            if(toId === 'monthlyAmount') {
                document.getElementById('monthlyAmountLabel').innerText = (val == 0) ? 'ãªã—' : val + 'ä¸‡å††';
            }
            if(toId === 'withdrawalRate') {
                document.getElementById('withdrawalLabel').innerText = (val == 0) ? 'ãªã—' : val + '%';
            }
            
            calculate();
        }

        function toggleTable() {
            const content = document.getElementById('tableContent');
            const arrow = document.getElementById('tableArrow');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                arrow.classList.add('rotate-180');
            } else {
                content.classList.add('hidden');
                arrow.classList.remove('rotate-180');
            }
        }

        // --- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
        function formatMoney(n) {
            if(n < 0) return '-' + formatMoney(-n);
            if(n < 10000) return Math.round(n).toLocaleString() + 'å††';
            const man = Math.floor(n / 10000);
            const oku = Math.floor(man / 10000);
            const restMan = man % 10000;
            if(oku > 0) return `${oku}å„„${restMan > 0 ? restMan.toLocaleString() + 'ä¸‡' : ''}å††`;
            return `${man.toLocaleString()}ä¸‡å††`;
        }

        function calculate() {
            const initial = (parseFloat(document.getElementById('initialAmount').value) || 0) * 10000;
            const monthly = (parseFloat(document.getElementById('monthlyAmount').value) || 0) * 10000;
            const years = parseInt(document.getElementById('years').value) || 20;
            const rateYearly = parseFloat(document.getElementById('annualRate').value) || 0;
            const withdrawRate = parseFloat(document.getElementById('withdrawalRate').value) || 0;

            const rateMonthly = rateYearly / 100 / 12;
            let current = initial;
            let totalInvest = initial;
            let totalWithdraw = 0;

            const labels = ['é–‹å§‹'];
            const dataAsset = [Math.round(current)];
            const tableRows = [];

            for(let y=1; y<=years; y++) {
                let w = 0;
                if(withdrawRate > 0) {
                    w = current * (withdrawRate / 100);
                    current -= w;
                    if(current < 0) current = 0;
                    totalWithdraw += w;
                }
                let investYearly = 0;
                for(let m=0; m<12; m++) {
                    current = (current + monthly) * (1 + rateMonthly);
                    totalInvest += monthly;
                    investYearly += monthly;
                }
                labels.push(y + 'å¹´');
                dataAsset.push(Math.round(current));
                
                tableRows.push({
                    year: y + 'å¹´ç›®',
                    col2: (withdrawRate > 0) ? w : investYearly,
                    asset: current
                });
            }

            document.getElementById('displayFinalAsset').innerText = formatMoney(current);
            document.getElementById('displayTotalInvestment').innerText = formatMoney(totalInvest);
            document.getElementById('displayTotalWithdrawn').innerText = formatMoney(totalWithdraw);
            
            const profit = current + totalWithdraw - totalInvest;
            const profitEl = document.getElementById('displayTotalProfit');
            profitEl.innerText = (profit>=0 ? '+' : '') + formatMoney(profit);
            profitEl.className = profit >= 0 ? "text-lg font-bold text-green-200" : "text-lg font-bold text-red-200";

            const tbody = document.getElementById('resultTableBody');
            const col2Header = document.getElementById('col2Header');
            if(withdrawRate > 0) {
                col2Header.innerText = "å—å–é¡ (å¹´é–“)";
                col2Header.className = "px-4 py-2 text-right font-semibold text-orange-600";
            } else {
                col2Header.innerText = "ç©ç«‹é¡ (å¹´é–“)";
                col2Header.className = "px-4 py-2 text-right font-semibold text-slate-500";
            }

            let html = '';
            tableRows.forEach(r => {
                const col2Class = (withdrawRate > 0) ? "text-orange-600 font-bold" : "text-slate-500";
                html += `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-4 py-3 font-medium text-slate-700">${r.year}</td>
                        <td class="px-4 py-3 text-right ${col2Class}">${formatMoney(r.col2)}</td>
                        <td class="px-4 py-3 text-right font-bold text-emerald-600">${formatMoney(r.asset)}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;

            drawChart(labels, dataAsset);
        }

        function drawChart(labels, data) {
            const ctx = document.getElementById('simulationChart').getContext('2d');
            if(myChart) myChart.destroy();
            const grad = ctx.createLinearGradient(0, 0, 0, 400);
            grad.addColorStop(0, 'rgba(16, 185, 129, 0.4)');
            grad.addColorStop(1, 'rgba(16, 185, 129, 0.0)');

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'è³‡ç”£æ¨ç§»',
                        data: data,
                        borderColor: '#10b981',
                        backgroundColor: grad,
                        borderWidth: 2.5,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            titleFont: { size: 13 },
                            bodyFont: { size: 13 },
                            padding: 10,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(ctx) {
                                    return 'è³‡ç”£: ' + formatMoney(ctx.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { maxTicksLimit: 6, color: '#94a3b8', font: { size: 11 } }
                        },
                        y: {
                            grid: { color: '#f1f5f9', borderDash: [4, 4] },
                            border: { display: false },
                            ticks: {
                                color: '#94a3b8',
                                font: { size: 11 },
                                callback: function(val) {
                                    if(val === 0) return '0';
                                    if(val >= 100000000) return (val/100000000).toFixed(1) + 'å„„';
                                    return (val/10000) + 'ä¸‡';
                                }
                            }
                        }
                    },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });
        }
    </script>
</body>
</html>
