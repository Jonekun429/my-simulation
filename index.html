<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ | è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­ä»˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸºæœ¬è¨­å®š */
        body {
            font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }
        .text-custom-green { color: #15803d; }
        .bg-custom-green { background-color: #15803d; }

        /* ã‚¿ãƒ–UIè¨­å®š */
        .tab-container {
            display: flex;
            overflow-x: auto;
            gap: 4px;
            padding-top: 8px;
            border-bottom: 2px solid #15803d;
        }
        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 4px;
            font-weight: bold;
            font-size: 0.85rem;
            text-align: center;
            border: 2px solid #e2e8f0;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            background-color: #f1f5f9;
            color: #64748b;
            transition: all 0.2s;
            position: relative;
            bottom: -2px;
            white-space: nowrap;
        }
        .tab-btn.active {
            background-color: #ffffff;
            color: #15803d;
            border-color: #15803d;
            border-width: 2px 2px 0 2px;
            z-index: 10;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ éƒ¨å“ */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; margin: 8px 0; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ffffff; border: 2px solid #10b981; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-top: -8px; }
        .dual-range::-webkit-slider-thumb { border: 2px solid #15803d; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; }
        
        .input-group:focus-within { border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .input-group-dual:focus-within { border-color: #15803d; box-shadow: 0 0 0 3px rgba(21, 128, 61, 0.1); }

        .bg-required { background-color: #fef9c3; border-color: #fde047; }
        .bg-cleared { background-color: #ffffff; border-color: #e2e8f0; }
        
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* è¨ºæ–­ãƒšãƒ¼ã‚¸ç”¨è£…é£¾ */
        /* ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .indicator-group { transition: transform 1s cubic-bezier(0.34, 1.56, 0.64, 1); }

        .advice-card {
            background: linear-gradient(135deg, #fffbeb 0%, #fff 100%);
            border: 2px solid #fcd34d;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 md:px-8 pt-4">
            <h1 class="text-xl md:text-2xl font-bold text-slate-800 flex items-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-custom-green mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                è³‡ç”£é‹ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
            </h1>
            
            <div class="tab-container no-scrollbar">
                <button onclick="switchTab('single')" id="tab-btn-single" class="tab-btn active">1éŠ˜æŸ„ã§è¨ˆç®—</button>
                <button onclick="switchTab('dual')" id="tab-btn-dual" class="tab-btn">2éŠ˜æŸ„ã§è¨ˆç®—</button>
                <button onclick="switchTab('hierarchy')" id="tab-btn-hierarchy" class="tab-btn">è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­</button>
                <button onclick="switchTab('guide')" id="tab-btn-guide" class="tab-btn">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</button>
            </div>
        </div>
    </div>

    <div class="flex-grow p-4 md:p-8 max-w-6xl mx-auto w-full">
        <div class="bg-white md:bg-transparent rounded-b-2xl md:rounded-none p-4 md:p-0 border md:border-none border-slate-200 border-t-0">
            
            <div id="tab-content-single" class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-start fade-in">
                <div class="lg:col-span-5 space-y-4">
                    <section class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                        <h2 class="text-lg font-bold text-slate-700 mb-3">1. é‹ç”¨å•†å“ã‚’é¸ã¶</h2>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="selectProductSingle('sp500')" id="btn-single-sp500" class="p-3 rounded-xl border-2 border-emerald-500 bg-emerald-50 text-emerald-700 font-bold transition-all relative">S&P500 (ç±³å›½æ ª)</button>
                            <button onclick="selectProductSingle('all')" id="btn-single-all" class="p-3 rounded-xl border border-slate-200 bg-white text-slate-500 font-medium transition-all relative">å…¨ä¸–ç•Œæ ªå¼</button>
                        </div>
                    </section>
                    <section class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 space-y-5">
                        <h2 class="text-lg font-bold text-slate-700">2. é‡‘é¡ã‚’å…¥ã‚Œã‚‹</h2>
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-sm font-bold text-slate-600">æƒ³å®šåˆ©å›ã‚Š (å¹´ç‡)</label>
                                <button onclick="resetSingleRate()" class="text-xs text-emerald-500 font-bold hover:text-emerald-600 transition">å¹³å‡å€¤ã«æˆ»ã™</button>
                            </div>
                            <div class="input-group flex items-center bg-white border-2 border-slate-200 rounded-xl px-3 py-2 transition-colors">
                                <input type="number" id="single-input-rate" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="13.25" step="0.01" oninput="calculateSingle()" onfocus="this.select()">
                                <span class="text-slate-400 font-bold ml-2">%</span>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-bold text-slate-600 mb-1 block">åˆæœŸæŠ•è³‡é¡ (å…ƒæ‰‹)</label>
                            <div id="single-initialGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 bg-required transition-colors">
                                <input type="number" id="single-initial" class="bg-transparent w-full text-xl font-bold text-right outline-none text-slate-700" placeholder="0" oninput="checkInput('single-initial', 'single-initialGroup'); calculateSingle();">
                                <span class="font-bold ml-2 text-slate-500">ä¸‡å††</span>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between"><span>æ¯æœˆã®ç©ç«‹é¡</span><span class="text-emerald-500 font-bold" id="single-monthlyLabel">3ä¸‡å††</span></label>
                            <input type="range" id="single-monthlySlider" min="0" max="30" value="3" oninput="syncInputs('single-monthlySlider', 'single-monthly', 'single-monthlyLabel', 'ä¸‡å††', true)">
                            <div id="single-monthlyGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 bg-cleared transition-colors">
                                <input type="number" id="single-monthly" class="bg-transparent w-full text-xl font-bold text-right outline-none text-slate-700" value="3" oninput="checkInput('single-monthly', 'single-monthlyGroup'); syncInputs('single-monthly', 'single-monthlySlider', 'single-monthlyLabel', 'ä¸‡å††', true);">
                                <span class="font-bold ml-2 text-slate-500">ä¸‡å††</span>
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between"><span>é‹ç”¨æœŸé–“</span><span class="text-emerald-500 font-bold" id="single-yearsLabel">20å¹´</span></label>
                            <input type="range" id="single-yearsSlider" min="1" max="50" value="20" oninput="syncInputs('single-yearsSlider', 'single-years', 'single-yearsLabel', 'å¹´', true)">
                            <div id="single-yearsGroup" class="input-group flex items-center border-2 rounded-xl px-3 py-2 bg-cleared transition-colors">
                                <input type="number" id="single-years" class="bg-transparent w-full text-xl font-bold text-right outline-none text-slate-700" value="20" oninput="checkInput('single-years', 'single-yearsGroup'); syncInputs('single-years', 'single-yearsSlider', 'single-yearsLabel', 'å¹´', true);">
                                <span class="font-bold ml-2 text-slate-500">å¹´</span>
                            </div>
                        </div>
                    </section>
                    <section class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                        <h2 class="text-lg font-bold text-slate-700 mb-1">3. å–ã‚Šå´©ã—è¨­å®š <span class="text-xs font-normal text-slate-400 ml-2">(ä»»æ„)</span></h2>
                        <div>
                            <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between"><span>æ¯å¹´1æœˆ1æ—¥ã®å–ã‚Šå´©ã—ç‡</span><span class="text-emerald-600 font-bold" id="single-withdrawalLabel">ãªã—</span></label>
                            <input type="range" id="single-withdrawalSlider" min="0" max="15" value="0" step="0.1" oninput="syncInputs('single-withdrawalSlider', 'single-withdrawal', 'single-withdrawalLabel', '%', true)">
                            <div class="flex items-center bg-white border-2 border-slate-200 rounded-xl px-3 py-2 mt-1 focus-within:border-emerald-500 transition-colors">
                                <input type="number" id="single-withdrawal" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="0" step="0.1" oninput="syncInputs('single-withdrawal', 'single-withdrawalSlider', 'single-withdrawalLabel', '%', true)" onfocus="this.select()"><span class="text-slate-500 font-bold ml-2">%</span>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="lg:col-span-7 space-y-4">
                    <div class="bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl p-6 text-white shadow-md">
                        <p class="text-emerald-50 text-sm font-bold mb-1">æœ€çµ‚è³‡ç”£æ®‹é«˜</p>
                        <div class="text-4xl md:text-5xl font-bold tracking-tight" id="single-displayFinalAsset">0å††</div>
                        <p class="text-emerald-100 text-xs mt-2 text-right">å…ƒæœ¬: <span id="single-displayInvestment">0å††</span></p>
                    </div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                        <div class="relative h-72 w-full"><canvas id="single-chart"></canvas></div>
                    </div>
                </div>
            </div>

            <div id="tab-content-dual" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8 items-start fade-in">
                <div class="lg:col-span-5 space-y-4">
                    <h2 class="text-lg font-bold text-slate-700">1. éŠ˜æŸ„ã”ã¨ã®é‡‘é¡ã‚’æ±ºã‚ã‚‹</h2>
                    <div class="bg-blue-50 rounded-2xl p-5 border border-blue-100">
                        <h3 class="font-bold text-blue-800 mb-3 flex items-center">ğŸ‡ºğŸ‡¸ S&P500 (ç±³å›½æ ª)</h3>
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-bold text-blue-600">æƒ³å®šåˆ©å›ã‚Š</label>
                                <button onclick="resetDualRate('sp500')" class="text-xs text-blue-500 hover:text-blue-700 font-bold cursor-pointer">å¹³å‡å€¤ã«æˆ»ã™</button>
                            </div>
                            <div class="input-group flex items-center bg-white border border-blue-200 rounded-xl px-2 py-1">
                                <input type="number" id="dual-sp500-rate" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right" value="13.25" step="0.01" oninput="calculateDual()" onfocus="this.select()"><span class="text-slate-500 text-xs font-bold ml-1">%</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div><label class="text-xs font-bold text-blue-700 block mb-1">åˆæœŸæŠ•è³‡é¡</label><div class="input-group flex items-center bg-white border border-blue-200 rounded-xl px-3 py-2"><input type="number" id="dual-sp500-init" class="bg-transparent w-full text-lg font-bold text-right outline-none" placeholder="0" oninput="calculateDual()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                            <div><label class="text-xs font-bold text-blue-700 block mb-1">æ¯æœˆã®ç©ç«‹é¡</label><div class="input-group flex items-center bg-white border border-blue-200 rounded-xl px-3 py-2"><input type="number" id="dual-sp500-month" class="bg-transparent w-full text-lg font-bold text-right outline-none" placeholder="ä¾‹: 3" value="3" oninput="calculateDual()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-2xl p-5 border border-green-100">
                        <h3 class="font-bold text-green-800 mb-3 flex items-center">ğŸŒ å…¨ä¸–ç•Œæ ªå¼ (ã‚ªãƒ«ã‚«ãƒ³)</h3>
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-xs font-bold text-green-600">æƒ³å®šåˆ©å›ã‚Š</label>
                                <button onclick="resetDualRate('all')" class="text-xs text-green-500 hover:text-green-700 font-bold cursor-pointer">å¹³å‡å€¤ã«æˆ»ã™</button>
                            </div>
                            <div class="input-group flex items-center bg-white border border-green-200 rounded-xl px-2 py-1">
                                <input type="number" id="dual-all-rate" class="bg-transparent w-full text-lg font-bold text-slate-800 outline-none text-right" value="9.99" step="0.01" oninput="calculateDual()" onfocus="this.select()"><span class="text-slate-500 text-xs font-bold ml-1">%</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div><label class="text-xs font-bold text-green-700 block mb-1">åˆæœŸæŠ•è³‡é¡</label><div class="input-group flex items-center bg-white border border-green-200 rounded-xl px-3 py-2"><input type="number" id="dual-all-init" class="bg-transparent w-full text-lg font-bold text-right outline-none" placeholder="0" oninput="calculateDual()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                            <div><label class="text-xs font-bold text-green-700 block mb-1">æ¯æœˆã®ç©ç«‹é¡</label><div class="input-group flex items-center bg-white border border-green-200 rounded-xl px-3 py-2"><input type="number" id="dual-all-month" class="bg-transparent w-full text-lg font-bold text-right outline-none" placeholder="ä¾‹: 2" value="2" oninput="calculateDual()"><span class="text-slate-500 text-sm font-bold ml-2">ä¸‡å††</span></div></div>
                        </div>
                    </div>
                    <section class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                        <h2 class="text-lg font-bold text-slate-700 mb-3">å…±é€šè¨­å®š</h2>
                        <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between"><span>é‹ç”¨æœŸé–“</span><span class="text-custom-green font-bold" id="dual-yearsLabel">20å¹´</span></label>
                        <input type="range" id="dual-yearsSlider" min="1" max="50" value="20" class="dual-range" oninput="syncInputs('dual-yearsSlider', 'dual-years', 'dual-yearsLabel', 'å¹´', false)">
                        <div class="input-group-dual flex items-center border-2 rounded-xl px-3 py-2 mt-1 bg-white border-slate-200">
                            <input type="number" id="dual-years" class="bg-transparent w-full text-xl font-bold text-right outline-none" value="20" oninput="syncInputs('dual-years', 'dual-yearsSlider', 'dual-yearsLabel', 'å¹´', false)">
                            <span class="text-slate-500 font-bold ml-2">å¹´</span>
                        </div>
                        <div class="mt-4">
                            <label class="text-sm font-bold text-slate-600 mb-1 flex justify-between"><span>æ¯å¹´1æœˆ1æ—¥ã®å–ã‚Šå´©ã—ç‡ <span class="text-xs font-normal text-slate-400 ml-2">(ä»»æ„)</span></span><span class="text-slate-500 font-bold" id="dual-withdrawalLabel">ãªã—</span></label>
                            <input type="range" id="dual-withdrawalSlider" min="0" max="15" value="0" step="0.1" oninput="syncInputs('dual-withdrawalSlider', 'dual-withdrawal', 'dual-withdrawalLabel', '%', false)" class="dual-range">
                            <div class="input-group-dual flex items-center bg-white border-2 border-slate-200 rounded-xl px-3 py-2 mt-1 transition-colors">
                                <input type="number" id="dual-withdrawal" class="bg-transparent w-full text-xl font-bold text-slate-800 outline-none text-right" value="0" step="0.1" oninput="syncInputs('dual-withdrawal', 'dual-withdrawalSlider', 'dual-withdrawalLabel', '%', false)" onfocus="this.select()"><span class="text-slate-500 font-bold ml-2">%</span>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="lg:col-span-7 space-y-4">
                    <div class="bg-custom-green rounded-2xl p-6 text-white shadow-md">
                        <p class="text-green-100 text-sm font-bold mb-1">æœ€çµ‚è³‡ç”£æ®‹é«˜ (2éŠ˜æŸ„åˆè¨ˆ)</p>
                        <div class="text-4xl md:text-5xl font-bold tracking-tight" id="dual-displayFinalAsset">0å††</div>
                        <p class="text-green-200 text-xs mt-2 text-right">å…ƒæœ¬åˆè¨ˆ: <span id="dual-displayInvestment">0å††</span></p>
                    </div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                        <div class="relative h-72 w-full"><canvas id="dual-chart"></canvas></div>
                    </div>
                </div>
            </div>

            <div id="tab-content-hierarchy" class="hidden fade-in space-y-6">
                
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
                    <h2 class="text-xl font-bold text-slate-800 mb-6 text-center">è³‡ç”£éšå±¤ãƒ”ãƒ©ãƒŸãƒƒãƒ‰è¨ºæ–­</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="flex justify-center">
                            <svg viewBox="0 0 400 320" class="w-full max-w-sm h-auto drop-shadow-sm">
                                <path id="tier-super" d="M200 20 L240 70 H160 Z" fill="#f87171" opacity="0.3" stroke="#fff" stroke-width="2" />
                                <text x="200" y="60" text-anchor="middle" font-size="10" fill="#b91c1c" font-weight="bold">è¶…å¯Œè£•å±¤(5å„„~)</text>
                                
                                <path id="tier-rich" d="M160 72 L240 72 L275 125 H125 Z" fill="#fb923c" opacity="0.3" stroke="#fff" stroke-width="2" />
                                <text x="200" y="110" text-anchor="middle" font-size="10" fill="#c2410c" font-weight="bold">å¯Œè£•å±¤(1å„„~)</text>
                                
                                <path id="tier-semi" d="M125 127 L275 127 L315 185 H85 Z" fill="#fbbf24" opacity="0.3" stroke="#fff" stroke-width="2" />
                                <text x="200" y="170" text-anchor="middle" font-size="10" fill="#b45309" font-weight="bold">æº–å¯Œè£•å±¤(5000ä¸‡~)</text>
                                
                                <path id="tier-upper" d="M85 187 L315 187 L355 250 H45 Z" fill="#4ade80" opacity="0.3" stroke="#fff" stroke-width="2" />
                                <text x="200" y="230" text-anchor="middle" font-size="10" fill="#15803d" font-weight="bold">ã‚¢ãƒƒãƒ‘ãƒ¼ãƒã‚¹(3000ä¸‡~)</text>
                                
                                <path id="tier-mass" d="M45 252 L355 252 L400 310 H0 Z" fill="#2dd4bf" opacity="0.3" stroke="#fff" stroke-width="2" />
                                <text x="200" y="290" text-anchor="middle" font-size="10" fill="#0f766e" font-weight="bold">ãƒã‚¹å±¤(~3000ä¸‡)</text>
                                
                                <g id="group-now" class="indicator-group">
                                    <text x="65" y="5" text-anchor="end" font-size="14" font-weight="bold" fill="#64748b">ç¾åœ¨</text>
                                    <path d="M70,0 L95,0 L95,-6 L120,8 L95,22 L95,16 L70,16 Z" fill="#64748b" stroke="none" transform="scale(0.8) translate(20, -8)" />
                                    <path d="M70 -5 H 100 L 100 -10 L 125 0 L 100 10 L 100 5 H 70 Z" fill="transparent" stroke="none" /> 
                                    <path d="M80 5 C80 5 100 5 100 5 C100 5 100 -5 100 -5 L130 0 L100 5 C100 5 100 15 100 15 L80 15 Z" fill="#64748b" style="display:none;"/>
                                    <path d="M85 8 L115 8 L115 0 L140 12 L115 24 L115 16 L85 16 Z" fill="#94a3b8" />
                                    <text x="95" y="16" font-size="10" fill="white" font-weight="bold">Start</text>
                                </g>

                                <g id="group-future" class="indicator-group">
                                    <text x="335" y="5" text-anchor="start" font-size="14" font-weight="bold" fill="#15803d">å°†æ¥</text>
                                    <path d="M315 8 L285 8 L285 0 L260 12 L285 24 L285 16 L315 16 Z" fill="#15803d" />
                                    <text x="290" y="16" font-size="10" fill="white" font-weight="bold">Goal</text>
                                </g>
                            </svg>
                        </div>

                        <div class="space-y-6">
                            <div class="flex justify-between items-center border-b pb-2">
                                <span class="text-sm text-slate-500 font-bold">Start (ç¾åœ¨)</span>
                                <span id="current-tier-name" class="text-lg font-bold text-slate-700">--</span>
                            </div>
                            <div class="flex justify-between items-center border-b border-emerald-100 pb-2">
                                <span class="text-sm text-emerald-600 font-bold">Goal (å°†æ¥)</span>
                                <span id="future-tier-name" class="text-2xl font-bold text-emerald-700">--</span>
                            </div>

                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-slate-500 font-bold text-xs">NEXT RANKã¾ã§</span>
                                    <span class="text-emerald-600 font-bold text-xs" id="next-tier-gap">ã‚ã¨ --ä¸‡å††</span>
                                </div>
                                <div class="w-full bg-slate-200 rounded-full h-3">
                                    <div id="next-tier-progress" class="bg-emerald-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-right text-slate-400 mt-1" id="next-tier-target">ç›®æ¨™: --ä¸‡å††</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="advice-card rounded-2xl p-6 shadow-md">
                    <h3 class="text-lg font-bold text-yellow-700 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸è¡Œãã«ã¯ï¼Ÿ
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white bg-opacity-80 p-4 rounded-xl border border-yellow-200">
                            <p class="text-xs font-bold text-slate-500 mb-1">ä»Šã®ç©ç«‹é¡ã®ã¾ã¾ãªã‚‰...</p>
                            <p class="text-sm text-slate-700">
                                ã‚ã¨ <span id="advice-years" class="text-xl font-bold text-emerald-600">--</span> å¹´ã§<br>
                                <span id="advice-next-tier-1" class="font-bold">--</span> ã«åˆ°é”ã§ãã¾ã™ï¼
                            </p>
                        </div>
                        <div class="bg-white bg-opacity-80 p-4 rounded-xl border border-yellow-200">
                            <p class="text-xs font-bold text-slate-500 mb-1">è¨­å®šã—ãŸæœŸé–“ã§å±Šãã«ã¯...</p>
                            <p class="text-sm text-slate-700">
                                æ¯æœˆã®ç©ç«‹ã‚’<br>
                                <span class="text-xl font-bold text-emerald-600">+<span id="advice-monthly-add">--</span>ä¸‡å††</span> å¢—ã‚„ã›ã°åˆ°é”ï¼
                            </p>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 mt-4 text-center">â€»ç¾åœ¨ã®åˆ©å›ã‚Šè¨­å®šã«åŸºã¥ã„ãŸå˜ç´”ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚</p>
                </div>
            </div>

            <div id="tab-content-guide" class="hidden fade-in bg-white rounded-2xl p-8 border border-slate-100">
                <h2 class="text-2xl font-bold mb-4 text-slate-800">ğŸ”° ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>
                <div class="space-y-4 text-slate-600">
                    <p><strong>1éŠ˜æŸ„ã§è¨ˆç®—ï¼š</strong> S&P500ã¾ãŸã¯å…¨ä¸–ç•Œæ ªå¼ã‚’é¸ã‚“ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚</p>
                    <p><strong>2éŠ˜æŸ„ã§è¨ˆç®—ï¼š</strong> è¤‡æ•°ã®éŠ˜æŸ„ã‚’çµ„ã¿åˆã‚ã›ãŸåˆè¨ˆè³‡ç”£ã®æ¨ç§»ã‚’è¨ˆç®—ã€‚</p>
                    <p><strong>è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­ï¼š</strong> è¨ˆç®—çµæœã‚’ã‚‚ã¨ã«ã€å¯Œè£•å±¤ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã®ã©ã“ã«ä½ç½®ã™ã‚‹ã‹ã‚’åˆ¤å®šã—ã€ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã®ãŸã‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- è¨­å®šãƒ‡ãƒ¼ã‚¿ ---
        const PRODUCTS = {
            sp500: { name: 'S&P500 (ç±³å›½æ ª)', rate: 13.25 },
            all: { name: 'å…¨ä¸–ç•Œæ ªå¼ (ã‚ªãƒ«ã‚«ãƒ³)', rate: 9.99 }
        };
        
        // è³‡ç”£éšå±¤ãƒ‡ãƒ¼ã‚¿ (ä¸‹é™å€¤: ä¸‡å††)
        const TIERS = [
            { id: 'tier-super', name: 'è¶…å¯Œè£•å±¤', min: 50000 }, 
            { id: 'tier-rich', name: 'å¯Œè£•å±¤', min: 10000 },  
            { id: 'tier-semi', name: 'æº–å¯Œè£•å±¤', min: 5000 },  
            { id: 'tier-upper', name: 'ã‚¢ãƒƒãƒ‘ãƒ¼ãƒã‚¹å±¤', min: 3000 }, 
            { id: 'tier-mass', name: 'ãƒã‚¹å±¤', min: 0 }
        ];
        
        let currentSingleProduct = 'sp500';
        let singleChart = null;
        let dualChart = null;
        let lastResult = { initial: 0, final: 0, inputs: { rate: 0, monthly: 0, years: 0, initial: 0 } }; 

        window.onload = () => {
            selectProductSingle('sp500');
            calculateSingle();
            
            document.getElementById('dual-sp500-month').value = 3;
            document.getElementById('dual-all-month').value = 2;
            calculateDual();
        };

        function switchTab(tabName) {
            ['single', 'dual', 'hierarchy', 'guide'].forEach(t => {
                document.getElementById('tab-btn-' + t).classList.remove('active');
                document.getElementById('tab-content-' + t).classList.add('hidden');
            });
            document.getElementById('tab-btn-' + tabName).classList.add('active');
            document.getElementById('tab-content-' + tabName).classList.remove('hidden');
            
            if(tabName === 'hierarchy') updateHierarchyUI();
            if(tabName === 'single' && singleChart) singleChart.resize();
            if(tabName === 'dual') {
                if(dualChart) dualChart.resize();
                calculateDual();
            }
        }

        function formatMoney(n) {
            if(n < 10000) return Math.round(n).toLocaleString() + 'å††';
            const oku = Math.floor(n / 100000000);
            const man = Math.floor((n % 100000000) / 10000);
            if(oku > 0) return `${oku}å„„${man > 0 ? man.toLocaleString() + 'ä¸‡' : ''}å††`;
            return `${man.toLocaleString()}ä¸‡å††`;
        }

        function checkInput(id, group) {
            const val = document.getElementById(id).value;
            const el = document.getElementById(group);
            if(val > 0) { el.classList.add('bg-cleared'); el.classList.remove('bg-required'); } 
            else { el.classList.remove('bg-cleared'); el.classList.add('bg-required'); }
        }

        function syncInputs(from, to, labelId, unit, isSingle) {
            const val = document.getElementById(from).value;
            document.getElementById(to).value = val;
            if(labelId) document.getElementById(labelId).innerText = val + unit;
            if(isSingle) {
                checkInput('single-monthly', 'single-monthlyGroup');
                checkInput('single-years', 'single-yearsGroup');
                calculateSingle();
            } else {
                calculateDual();
            }
        }

        // --- Single Mode ---
        function selectProductSingle(key) {
            currentSingleProduct = key;
            const p = PRODUCTS[key];
            ['sp500', 'all'].forEach(k => {
                const btn = document.getElementById('btn-single-' + k);
                if(k === key) {
                    btn.className = "p-3 rounded-xl border-2 border-emerald-500 bg-emerald-50 text-emerald-700 font-bold transition-all relative";
                    if(!btn.innerHTML.includes('svg')) btn.innerHTML += '<span class="absolute top-1 right-1 text-emerald-500">â—</span>';
                } else {
                    btn.className = "p-3 rounded-xl border border-slate-200 bg-white text-slate-500 font-medium transition-all relative";
                    const span = btn.querySelector('span'); if(span) span.remove();
                }
            });
            document.getElementById('single-input-rate').value = p.rate;
            calculateSingle();
        }

        function resetSingleRate() {
            document.getElementById('single-input-rate').value = PRODUCTS[currentSingleProduct].rate;
            calculateSingle();
        }

        function calculateSingle() {
            const initial = (parseFloat(document.getElementById('single-initial').value) || 0) * 10000;
            const monthly = (parseFloat(document.getElementById('single-monthly').value) || 0) * 10000;
            const years = parseInt(document.getElementById('single-years').value) || 20;
            const rateYearly = parseFloat(document.getElementById('single-input-rate').value) || 0;
            const rate = rateYearly / 100 / 12;

            let current = initial;
            const labels = ['é–‹å§‹'], data = [Math.round(current)];

            for(let y=1; y<=years; y++) {
                for(let m=0; m<12; m++) current = (current + monthly) * (1 + rate);
                labels.push(y + 'å¹´');
                data.push(Math.round(current));
            }

            lastResult = { 
                initial: initial, 
                final: current, 
                inputs: { rate: rateYearly, monthly: monthly, years: years, initial: initial } 
            };

            document.getElementById('single-displayFinalAsset').innerText = formatMoney(current);
            document.getElementById('single-displayInvestment').innerText = formatMoney(initial + (monthly * 12 * years));
            drawChart('single-chart', labels, data, 'single');
        }

        // --- Dual Mode ---
        function resetDualRate(type) {
            if(type === 'sp500') document.getElementById('dual-sp500-rate').value = PRODUCTS.sp500.rate;
            else document.getElementById('dual-all-rate').value = PRODUCTS.all.rate;
            calculateDual();
        }

        function calculateDual() {
            const spInit = (parseFloat(document.getElementById('dual-sp500-init').value) || 0) * 10000;
            const spMonth = (parseFloat(document.getElementById('dual-sp500-month').value) || 0) * 10000;
            const spRate = (parseFloat(document.getElementById('dual-sp500-rate').value) || 0) / 100 / 12;

            const allInit = (parseFloat(document.getElementById('dual-all-init').value) || 0) * 10000;
            const allMonth = (parseFloat(document.getElementById('dual-all-month').value) || 0) * 10000;
            const allRate = (parseFloat(document.getElementById('dual-all-rate').value) || 0) / 100 / 12;

            const years = parseInt(document.getElementById('dual-years').value) || 20;

            let spCurrent = spInit, allCurrent = allInit;
            const labels = ['é–‹å§‹'], data = [Math.round(spInit + allInit)];

            for(let y=1; y<=years; y++) {
                for(let m=0; m<12; m++) {
                    spCurrent = (spCurrent + spMonth) * (1 + spRate);
                    allCurrent = (allCurrent + allMonth) * (1 + allRate);
                }
                labels.push(y + 'å¹´');
                data.push(Math.round(spCurrent + allCurrent));
            }

            const totalCurrent = spCurrent + allCurrent;
            const totalInvest = (spInit + allInit) + ((spMonth + allMonth) * 12 * years);

            const totalMonthly = spMonth + allMonth;
            const weightedRate = totalMonthly > 0 
                ? ((spRate * 12 * 100 * spMonth) + (allRate * 12 * 100 * allMonth)) / totalMonthly 
                : (parseFloat(document.getElementById('dual-sp500-rate').value)); 

            lastResult = { 
                initial: (spInit + allInit), 
                final: totalCurrent,
                inputs: { 
                    rate: weightedRate, 
                    monthly: totalMonthly, 
                    years: years, 
                    initial: (spInit + allInit) 
                }
            };

            document.getElementById('dual-displayFinalAsset').innerText = formatMoney(totalCurrent);
            document.getElementById('dual-displayInvestment').innerText = formatMoney(totalInvest);
            drawChart('dual-chart', labels, data, 'dual');
        }

        // --- Chart ---
        function drawChart(id, labels, data, mode) {
            const ctx = document.getElementById(id).getContext('2d');
            if(id === 'single-chart') { if(singleChart) singleChart.destroy(); }
            else { if(dualChart) dualChart.destroy(); }

            const color = mode === 'single' ? '#10b981' : '#15803d';
            const chart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets: [{ data, borderColor: color, backgroundColor: color + '22', fill: true, tension: 0.3, pointRadius: 0 }] },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: { x: { display: false }, y: { display: false } }, 
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });
            if(id === 'single-chart') singleChart = chart; else dualChart = chart;
        }

        // --- è³‡ç”£ã‚¯ãƒ©ã‚¹è¨ºæ–­ & ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ ---
        function updateHierarchyUI() {
            const finalMan = lastResult.final / 10000;
            const initMan = lastResult.initial / 10000;

            const currentTierIndex = TIERS.findIndex(t => initMan >= t.min);
            const currentTier = currentTierIndex !== -1 ? TIERS[currentTierIndex] : TIERS[4];
            
            const futureTierIndex = TIERS.findIndex(t => finalMan >= t.min);
            const futureTier = futureTierIndex !== -1 ? TIERS[futureTierIndex] : TIERS[4];

            document.getElementById('current-tier-name').innerText = currentTier.name + ` (${formatMoney(lastResult.initial)})`;
            document.getElementById('future-tier-name').innerText = futureTier.name + ` (${formatMoney(lastResult.final)})`;

            // çŸ¢å°ä½ç½®ã®æ›´æ–° (SVG Groupã®ç§»å‹•)
            const yMap = { 'tier-super': 45, 'tier-rich': 95, 'tier-semi': 155, 'tier-upper': 215, 'tier-mass': 280 };
            
            const gNow = document.getElementById('group-now');
            const gFuture = document.getElementById('group-future');
            
            // translateã§Yåº§æ¨™ã ã‘å‹•ã‹ã™
            gNow.setAttribute('transform', `translate(0, ${yMap[currentTier.id]})`);
            gFuture.setAttribute('transform', `translate(0, ${yMap[futureTier.id]})`);

            // æ¬¡ã®ãƒ©ãƒ³ã‚¯ã¸ã®è¨ˆç®—
            let targetTier = TIERS[4]; 
            if (futureTierIndex > 0) targetTier = TIERS[futureTierIndex - 1]; 
            else targetTier = TIERS[0]; 
            
            if(finalMan >= targetTier.min && futureTierIndex === 0) {
                document.getElementById('next-tier-gap').innerText = "æœ€é«˜ãƒ©ãƒ³ã‚¯åˆ°é”ï¼";
                document.getElementById('next-tier-progress').style.width = "100%";
                document.getElementById('next-tier-target').innerText = "Goal!";
                document.getElementById('advice-years').innerText = "0";
                document.getElementById('advice-next-tier-1').innerText = "ç¶­æŒãƒ»ç¶™æ‰¿";
                document.getElementById('advice-monthly-add').innerText = "0";
                return;
            }

            const gap = (targetTier.min * 10000) - lastResult.final;
            let progress = (lastResult.final / (targetTier.min * 10000)) * 100;
            if(progress > 100) progress = 100;

            document.getElementById('next-tier-gap').innerText = `ã‚ã¨ ${formatMoney(gap > 0 ? gap : 0)}`;
            document.getElementById('next-tier-progress').style.width = `${progress}%`;
            document.getElementById('next-tier-target').innerText = `ç›®æ¨™: ${targetTier.name} (${targetTier.min}ä¸‡å††)`;

            // ã‚¢ãƒ‰ãƒã‚¤ã‚¹è¨ˆç®—
            const r = lastResult.inputs.rate / 100 / 12; 
            const monthly = lastResult.inputs.monthly;
            const currentAsset = lastResult.initial;
            const targetAmount = targetTier.min * 10000;

            let yearsToGoal = 0;
            let tempAsset = currentAsset;
            for(let i=1; i<=1200; i++) {
                tempAsset = (tempAsset + monthly) * (1 + r);
                if(tempAsset >= targetAmount) {
                    yearsToGoal = (i / 12).toFixed(1);
                    break;
                }
            }
            document.getElementById('advice-years').innerText = yearsToGoal > 0 ? yearsToGoal : "âˆ";
            document.getElementById('advice-next-tier-1').innerText = targetTier.name;

            const n = lastResult.inputs.years * 12; 
            const compoundFactor = Math.pow(1 + r, n);
            const initialGrown = currentAsset * compoundFactor;
            
            let requiredMonthly = 0;
            if (targetAmount > initialGrown) {
                const numerator = (targetAmount - initialGrown) * r;
                const denominator = compoundFactor - 1;
                requiredMonthly = numerator / denominator;
            }
            const additionalMonthly = Math.max(0, requiredMonthly - monthly);
            const addMan = Math.ceil(additionalMonthly / 10000);
            
            document.getElementById('advice-monthly-add').innerText = addMan;
        }
    </script>
</body>
</html>
